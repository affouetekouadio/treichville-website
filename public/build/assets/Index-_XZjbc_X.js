import{u as ie,r as o,j as e,H as le}from"./app-BHzqiJ_z.js";import{A as ce}from"./app-layout-p_JMC4Gz.js";import{u as de,b as O,X as _}from"./NotificationContainer-CtIDklMV.js";import{T as me,C as ue}from"./ConfirmDialog-pKaKMbcM.js";import{I as pe}from"./ImagePreviewModal-BqYWZ81o.js";import{L as xe,l as u,a as ge,b as fe}from"./listing-DuJ96Ipm.js";import{u as he}from"./use-listing-search-sL1Q9-BQ.js";import{P as be}from"./plus-DQ3YaAMn.js";import{G as je}from"./grip-vertical-BR-UoTYZ.js";import{E as ye}from"./eye-C9wR_PQl.js";import{T as ve}from"./trees-K6PivAcH.js";import{W as Ne}from"./waves-CXMbL2tg.js";import{S as we}from"./square-pen-jRmxV4gH.js";import{U as Se}from"./upload-Cn_CCo2O.js";/* empty css            */import"./utils-B6rCUee9.js";import"./button-DI_2iZ4T.js";import"./index-BHQWyDIh.js";import"./index-LXxb8B22.js";import"./proxy-xxjnpx_T.js";import"./index-w_94M6Cx.js";import"./index-CMWG4mbA.js";import"./book-open-BKJjOrba.js";import"./megaphone-BvfTVna8.js";import"./tag-UAamrcmp.js";import"./users-BQ-bCsJ7.js";import"./chevron-right-BaDd2qxa.js";import"./download-DrvjlFl9.js";const qe=({lieux:p=[],listing:y})=>{const{addNotification:x}=de(),{url:z}=ie(),l=z.split("?")[0],[w,R]=o.useState(p),[K,h]=o.useState(!1),[A,M]=o.useState(!1),[g,X]=o.useState(null),[S,q]=o.useState({open:!1,id:null}),[V,G]=o.useState(!1),[C,U]=o.useState({open:!1,url:"",title:""}),[H,E]=o.useState(null),[r,i]=o.useState({type:"Parc",nom:"",description:"",horaires:"",acces:"Gratuit",equipements:[""],actif:!0}),[$,P]=o.useState(null),[v,k]=o.useState(null),[D,J]=o.useState(y?.filters.search??""),L=y?.filters.sort??"ordre",T=y?.filters.direction??"asc",f=y?.pagination??{page:1,per_page:15,total:p.length,last_page:1},c=o.useMemo(()=>({search:D,sort:L,direction:T,per_page:f.per_page}),[f.per_page,D,T,L]);he(l,c),o.useEffect(()=>{R(p)},[p]);const N=()=>{i({type:"Parc",nom:"",description:"",horaires:"",acces:"Gratuit",equipements:[""],actif:!0}),P(null),E(null),X(null)},B=t=>{i({type:t.type,nom:t.nom,description:t.description,horaires:t.horaires||"",acces:t.acces,equipements:t.equipements&&t.equipements.length>0?t.equipements:[""],actif:t.actif}),P(null),E(t.image_url),X(t.id),h(!0)},Q=async t=>{t.preventDefault(),M(!0);try{const s=new FormData;s.append("type",r.type),s.append("nom",r.nom),s.append("description",r.description),s.append("horaires",r.horaires||""),s.append("acces",r.acces),s.append("actif",r.actif?"1":"0"),r.equipements.filter(d=>d.trim()!=="").forEach((d,a)=>{s.append(`equipements[${a}]`,d)}),$&&s.append("image",$),g&&s.append("_method","PUT");const m=document.querySelector('meta[name="csrf-token"]')?.content??"",I=g?`/admin/api/lieux/${g}`:"/admin/api/lieux",b=await fetch(I,{method:"POST",headers:{"X-CSRF-TOKEN":m,"X-Requested-With":"XMLHttpRequest"},body:s});if(!b.ok){const d=await b.json();throw new Error(d.message||"Erreur de sauvegarde")}const F=await b.json();x("success",F.message||(g?"Lieu modifié":"Lieu créé")),h(!1),N(),u(l,{...c,page:1})}catch(s){console.error(s),x("error",s instanceof Error?s.message:"Impossible de sauvegarder le lieu")}finally{M(!1)}},Y=t=>{q({open:!0,id:t})},Z=async()=>{if(S.id){G(!0);try{const t=document.querySelector('meta[name="csrf-token"]')?.content??"",s=await fetch(`/admin/api/lieux/${S.id}`,{method:"DELETE",headers:{"X-CSRF-TOKEN":t,"X-Requested-With":"XMLHttpRequest"}});if(!s.ok){const m=await s.json();throw new Error(m.message||"Erreur de suppression")}const n=await s.json();x("success",n.message||"Lieu supprimé"),q({open:!1,id:null}),u(l,c)}catch(t){console.error(t),x("error",t instanceof Error?t.message:"Impossible de supprimer le lieu")}finally{G(!1)}}},ee=t=>{const s=t.target.files?.[0];s&&(P(s),E(URL.createObjectURL(s)))},te=()=>{i({...r,equipements:[...r.equipements,""]})},se=t=>{const s=r.equipements.filter((n,m)=>m!==t);i({...r,equipements:s.length>0?s:[""]})},re=(t,s)=>{const n=[...r.equipements];n[t]=s,i({...r,equipements:n})},ae=(t,s)=>{k(s),t.dataTransfer.effectAllowed="move"},ne=t=>{t.preventDefault(),t.dataTransfer.dropEffect="move"},oe=async(t,s)=>{if(t.preventDefault(),!v||v===s){k(null);return}const n=[...w],m=n.findIndex(a=>a.id===v),I=n.findIndex(a=>a.id===s),[b]=n.splice(m,1);n.splice(I,0,b);const F=n.map(a=>a.ordre).sort((a,j)=>a-j),d=n.map((a,j)=>({...a,ordre:F[j]??a.ordre}));R(d),k(null);try{const a=document.querySelector('meta[name="csrf-token"]')?.content??"",j=d.map(W=>({id:W.id,ordre:W.ordre}));if(!(await fetch("/admin/api/lieux/update-order",{method:"POST",headers:{"X-CSRF-TOKEN":a,"X-Requested-With":"XMLHttpRequest","Content-Type":"application/json"},body:JSON.stringify({orders:j})})).ok)throw new Error("Erreur lors de la mise à jour de l'ordre");x("success","Ordre mis à jour")}catch(a){console.error(a),x("error","Erreur lors de la mise à jour de l'ordre"),u(l,c)}};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-col gap-6 p-4",children:[e.jsx(le,{title:"Endroits à découvrir"}),e.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex h-10 w-10 items-center justify-center rounded-lg bg-blue-100",children:e.jsx(O,{className:"h-5 w-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Endroits à découvrir"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Gestion des parcs et piscines (ordre modifiable par glisser-déposer)"})]})]}),e.jsxs("button",{onClick:()=>{N(),h(!0)},className:"inline-flex items-center gap-2 rounded-lg bg-[#f8812f] px-4 py-2 text-sm font-semibold text-white shadow-sm hover:bg-orange-600 transition-colors",children:[e.jsx(be,{className:"h-4 w-4"}),"Nouveau lieu"]})]}),e.jsx(xe,{search:D,perPage:f.per_page,sort:{value:L,direction:T},sortOptions:[{value:"ordre",label:"Ordre"},{value:"nom",label:"Nom"},{value:"type",label:"Type"},{value:"created_at",label:"Créé le"}],onSearchChange:J,onSearchSubmit:()=>u(l,{...c,page:1}),onPerPageChange:t=>u(l,{...c,per_page:t,page:1}),onExport:t=>ge(l,c,t),onSortChange:(t,s)=>u(l,{...c,sort:t,direction:s})}),e.jsx("div",{className:"rounded-xl border border-gray-200 bg-white shadow-sm",children:w.length===0?e.jsxs("div",{className:"p-12 text-center",children:[e.jsx(O,{className:"mx-auto h-12 w-12 text-[#03800a]"}),e.jsx("h3",{className:"mt-4 text-lg font-semibold text-gray-900",children:"Aucun lieu"}),e.jsx("p",{className:"mt-2 text-sm text-gray-500",children:"Commencez par ajouter un parc ou une piscine"})]}):e.jsx("div",{className:"divide-y divide-gray-200",children:w.map(t=>e.jsxs("div",{draggable:!0,onDragStart:s=>ae(s,t.id),onDragOver:ne,onDrop:s=>oe(s,t.id),className:`flex items-center gap-4 p-4 transition-colors ${v===t.id?"opacity-50":"hover:bg-gray-50"} ${t.actif?"":"bg-gray-50"}`,children:[e.jsx("div",{className:"cursor-move text-gray-400 hover:text-[#03800a]",children:e.jsx(je,{className:"h-5 w-5"})}),e.jsx("div",{className:"flex-shrink-0",children:t.image_url?e.jsxs("button",{onClick:()=>U({open:!0,url:t.image_url,title:t.nom}),className:"relative group",children:[e.jsx("img",{src:t.image_url,alt:t.nom,className:"h-16 w-16 rounded-lg object-cover ring-2 ring-gray-200 group-hover:ring-[#f8812f] transition-all"}),e.jsx("div",{className:"absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 transition-opacity rounded-lg flex items-center justify-center",children:e.jsx(ye,{className:"h-5 w-5 text-white"})})]}):e.jsx("div",{className:"h-16 w-16 rounded-lg bg-gray-100 flex items-center justify-center",children:e.jsx(O,{className:"h-8 w-8 text-gray-400"})})}),e.jsx("div",{className:"flex-shrink-0",children:t.type==="Parc"?e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full bg-green-100 px-3 py-1 text-xs font-medium text-green-700",children:[e.jsx(ve,{className:"h-3 w-3"}),"Parc"]}):e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full bg-blue-100 px-3 py-1 text-xs font-medium text-blue-700",children:[e.jsx(Ne,{className:"h-3 w-3"}),"Piscine"]})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"text-base font-semibold text-gray-900",children:t.nom}),!t.actif&&e.jsx("span",{className:"inline-flex items-center rounded-full bg-gray-100 px-2 py-0.5 text-xs font-medium text-gray-600",children:"Inactif"}),e.jsx("span",{className:`inline-flex items-center rounded-full px-2 py-0.5 text-xs font-medium ${t.acces==="Gratuit"?"bg-green-100 text-green-700":"bg-orange-100 text-orange-700"}`,children:t.acces})]}),e.jsx("p",{className:"text-sm text-gray-600 line-clamp-1",children:t.description})]}),e.jsx("div",{className:"text-center",children:e.jsx("span",{className:"inline-flex h-8 w-8 items-center justify-center rounded-full bg-blue-100 text-sm font-semibold text-blue-600",children:t.ordre})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>B(t),className:"rounded p-2 text-blue-600 hover:bg-blue-50 transition-colors",title:"Éditer",children:e.jsx(we,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>Y(t.id),className:"rounded p-2 text-red-600 hover:bg-red-50 transition-colors",title:"Supprimer",children:e.jsx(me,{className:"h-4 w-4"})})]})]},t.id))})}),e.jsx(fe,{page:f.page,lastPage:f.last_page,total:f.total,onPageChange:t=>u(l,{...c,page:t})})]}),K&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-start justify-center bg-black/40 px-4 overflow-y-auto py-6",children:e.jsxs("div",{className:"w-full max-w-2xl rounded-2xl bg-white shadow-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between border-b px-6 py-4",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-xs uppercase tracking-wide text-gray-500",children:[g?"Modifier":"Nouveau"," lieu"]}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:g?"Modifier le lieu":"Ajouter un lieu"})]}),e.jsx("button",{onClick:()=>{h(!1),N()},className:"rounded-full p-2 text-gray-500 hover:bg-gray-100",children:e.jsx(_,{className:"h-5 w-5"})})]}),e.jsxs("form",{className:"space-y-4 px-6 py-5",onSubmit:Q,children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Type *"}),e.jsxs("select",{required:!0,value:r.type,onChange:t=>i({...r,type:t.target.value}),className:"mt-1 w-full rounded-lg border border-gray-200 px-3 py-2 focus:border-[#f8812f] focus:outline-none focus:ring-2 focus:ring-orange-200",children:[e.jsx("option",{value:"Parc",children:"Parc"}),e.jsx("option",{value:"Piscine",children:"Piscine"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Accès *"}),e.jsxs("select",{required:!0,value:r.acces,onChange:t=>i({...r,acces:t.target.value}),className:"mt-1 w-full rounded-lg border border-gray-200 px-3 py-2 focus:border-[#f8812f] focus:outline-none focus:ring-2 focus:ring-orange-200",children:[e.jsx("option",{value:"Gratuit",children:"Gratuit"}),e.jsx("option",{value:"Payant",children:"Payant"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Nom *"}),e.jsx("input",{required:!0,value:r.nom,onChange:t=>i({...r,nom:t.target.value}),className:"mt-1 w-full rounded-lg border border-gray-200 px-3 py-2 focus:border-[#f8812f] focus:outline-none focus:ring-2 focus:ring-orange-200",placeholder:"Ex: Jardin Public de Treichville"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Description *"}),e.jsx("textarea",{required:!0,rows:3,value:r.description,onChange:t=>i({...r,description:t.target.value}),className:"mt-1 w-full rounded-lg border border-gray-200 px-3 py-2 focus:border-[#f8812f] focus:outline-none focus:ring-2 focus:ring-orange-200",placeholder:"Décrivez le lieu..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Horaires (optionnel)"}),e.jsx("input",{value:r.horaires,onChange:t=>i({...r,horaires:t.target.value}),className:"mt-1 w-full rounded-lg border border-gray-200 px-3 py-2 focus:border-[#f8812f] focus:outline-none focus:ring-2 focus:ring-orange-200",placeholder:"Ex: 6h00 - 18h00"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 mb-2 block",children:"Équipements (optionnel)"}),r.equipements.map((t,s)=>e.jsxs("div",{className:"flex gap-2 mb-2",children:[e.jsx("input",{value:t,onChange:n=>re(s,n.target.value),className:"flex-1 rounded-lg border border-gray-200 px-3 py-2 focus:border-[#f8812f] focus:outline-none focus:ring-2 focus:ring-orange-200",placeholder:"Ex: Aires de jeux"}),r.equipements.length>1&&e.jsx("button",{type:"button",onClick:()=>se(s),className:"px-3 py-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors",children:e.jsx(_,{className:"h-4 w-4"})})]},s)),e.jsx("button",{type:"button",onClick:te,className:"mt-1 text-sm text-[#03800a] hover:text-green-700 font-medium",children:"+ Ajouter un équipement"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Photo"}),H&&e.jsx("div",{className:"mt-2 mb-3",children:e.jsx("img",{src:H,alt:"Aperçu",className:"h-32 w-full rounded-lg object-cover border-2 border-orange-200"})}),e.jsxs("label",{className:"mt-2 flex cursor-pointer items-center gap-2 rounded-lg border-2 border-dashed border-gray-300 px-4 py-3 hover:border-[#f8812f] hover:bg-orange-50 transition-colors",children:[e.jsx(Se,{className:"h-5 w-5 text-gray-500"}),e.jsx("span",{className:"text-sm text-gray-600",children:"Choisir une photo"}),e.jsx("input",{type:"file",accept:"image/*",onChange:ee,className:"hidden"})]}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Format image, max 10 Mo"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",id:"actif",checked:r.actif,onChange:t=>i({...r,actif:t.target.checked}),className:"h-4 w-4 rounded border-gray-300 text-[#03800a] focus:ring-[#03800a]"}),e.jsx("label",{htmlFor:"actif",className:"text-sm font-medium text-gray-700",children:"Actif (visible sur le site)"})]}),e.jsxs("div",{className:"flex items-center justify-end gap-3 border-t pt-4",children:[e.jsx("button",{type:"button",onClick:()=>{h(!1),N()},className:"rounded-lg px-4 py-2 text-sm font-semibold text-gray-600 hover:bg-gray-100",children:"Annuler"}),e.jsx("button",{type:"submit",disabled:A,className:"rounded-lg bg-[#03800a] px-5 py-2 text-sm font-semibold text-white shadow-sm hover:bg-green-700 disabled:opacity-60",children:A?"Enregistrement...":"Enregistrer"})]})]})]})}),e.jsx(ue,{open:S.open,onClose:()=>q({open:!1,id:null}),onConfirm:Z,title:"Supprimer ce lieu ?",message:"Cette action est irréversible. Le lieu sera définitivement supprimé.",confirmText:"Supprimer",type:"danger",loading:V}),e.jsx(pe,{open:C.open,onClose:()=>U({open:!1,url:"",title:""}),imageUrl:C.url,title:C.title})]})};qe.layout=p=>e.jsx(ce,{children:p});export{qe as default};
