import{r as a,j as e,H as D}from"./app-BOeBlu4b.js";import{M as E,A as Z}from"./app-layout-01HyJkhw.js";import{u as ee,X as te}from"./NotificationContainer-DsMHCjNZ.js";import{T as se,C as re}from"./ConfirmDialog-BQnA4M2F.js";import{I as ae}from"./ImagePreviewModal-DSzB5LBr.js";import{P as ie}from"./plus-BrowsBK3.js";import{E as ne}from"./eye-CO2Nf5nM.js";import{c as X}from"./proxy-BomrNsxp.js";import{S as oe}from"./square-pen-pwgSHEdM.js";import{U}from"./upload-DDGsKQf1.js";/* empty css            */import"./utils-Y8vIEmjK.js";import"./button-BAOKhKj2.js";import"./index-zbMUL0ku.js";import"./index-ky7ia0w0.js";import"./index-w_94M6Cx.js";import"./index-CMWG4mbA.js";import"./book-open-CkQh-Dm6.js";import"./megaphone-CUfDwg7a.js";import"./tag-D1ZlLnvX.js";import"./users-m-PM2a8u.js";import"./chevron-right-DhTCxD4C.js";import"./download-CrxwCkyw.js";const le=[["rect",{width:"20",height:"12",x:"2",y:"6",rx:"6",ry:"6",key:"f2vt7d"}],["circle",{cx:"8",cy:"12",r:"2",key:"1nvbw3"}]],ce=X("ToggleLeft",le);const de=[["rect",{width:"20",height:"12",x:"2",y:"6",rx:"6",ry:"6",key:"f2vt7d"}],["circle",{cx:"16",cy:"12",r:"2",key:"4ma0v8"}]],me=X("ToggleRight",de),ue=()=>{const{addNotification:o}=ee(),[S,O]=a.useState([]),[H,M]=a.useState(!0),[$,d]=a.useState(!1),[k,F]=a.useState(!1),[c,T]=a.useState(null),[f,j]=a.useState({open:!1,id:null}),[K,R]=a.useState(!1),[b,I]=a.useState({open:!1,url:"",title:""}),[i,v]=a.useState({}),[q,y]=a.useState(null),[L,N]=a.useState(null),m=a.useRef(null),u=a.useRef(null),[r,n]=a.useState({titre_vision:"",salutation:"",contenu_message:"",texte_conclusion:"",nom_maire:"",titre_maire:"",citation:"",actif:!1}),[P,w]=a.useState(null),[A,_]=a.useState(null);a.useEffect(()=>{p()},[]);const p=async()=>{try{const s=await(await fetch("/admin/api/messages-maire")).json();O(s),M(!1)}catch(t){console.error("Erreur:",t),o("error","Erreur lors du chargement des messages"),M(!1)}},h=()=>{n({titre_vision:"",salutation:"",contenu_message:"",texte_conclusion:"",nom_maire:"",titre_maire:"",citation:"",actif:!1}),w(null),_(null),y(null),N(null),v({}),m.current&&(m.current.value=""),u.current&&(u.current.value=""),T(null)},W=t=>{n({titre_vision:t.titre_vision,salutation:t.salutation,contenu_message:t.contenu_message,texte_conclusion:t.texte_conclusion||"",nom_maire:t.nom_maire,titre_maire:t.titre_maire,citation:t.citation||"",actif:t.actif}),w(null),_(null),m.current&&(m.current.value=""),u.current&&(u.current.value=""),y(t.photo_url),N(t.image_fond_url),T(t.id),d(!0)},z=async t=>{t.preventDefault(),F(!0),v({});try{const s=new FormData;s.append("titre_vision",r.titre_vision),s.append("salutation",r.salutation),s.append("contenu_message",r.contenu_message),s.append("texte_conclusion",r.texte_conclusion||""),s.append("nom_maire",r.nom_maire),s.append("titre_maire",r.titre_maire),s.append("citation",r.citation||""),s.append("actif",r.actif?"1":"0"),P&&s.append("photo",P),A&&s.append("image_fond",A),c&&s.append("_method","PUT");const l=document.querySelector('meta[name="csrf-token"]')?.content??"",x=c?`/admin/api/messages-maire/${c}`:"/admin/api/messages-maire",g=await fetch(x,{method:"POST",headers:{"X-CSRF-TOKEN":l,"X-Requested-With":"XMLHttpRequest"},body:s});if(!g.ok){const C=await g.json();throw C?.errors&&v(C.errors),new Error(C.message||"Erreur de sauvegarde")}const Y=await g.json();o("success",Y.message||(c?"Message modifié":"Message créé")),d(!1),h(),p()}catch(s){console.error(s),o("error",s instanceof Error?s.message:"Impossible de sauvegarder le message")}finally{F(!1)}},G=t=>{j({open:!0,id:t})},J=async()=>{if(f.id){R(!0);try{const t=document.querySelector('meta[name="csrf-token"]')?.content??"",s=await fetch(`/admin/api/messages-maire/${f.id}`,{method:"DELETE",headers:{"X-CSRF-TOKEN":t,"X-Requested-With":"XMLHttpRequest"}});if(!s.ok){const x=await s.json();throw new Error(x.message||"Erreur de suppression")}const l=await s.json();o("success",l.message||"Message supprimé"),j({open:!1,id:null}),p()}catch(t){console.error(t),o("error",t instanceof Error?t.message:"Impossible de supprimer le message")}finally{R(!1)}}},V=async t=>{try{const s=document.querySelector('meta[name="csrf-token"]')?.content??"",l=await fetch(`/admin/api/messages-maire/${t}/toggle-actif`,{method:"POST",headers:{"X-CSRF-TOKEN":s,"X-Requested-With":"XMLHttpRequest"}});if(!l.ok){const g=await l.json();throw new Error(g.message||"Erreur")}const x=await l.json();o("success",x.message),p()}catch(s){console.error(s),o("error",s instanceof Error?s.message:"Erreur lors du changement de statut")}},B=t=>{const s=t.target.files?.[0];s&&(w(s),y(URL.createObjectURL(s)))},Q=t=>{const s=t.target.files?.[0];s&&(_(s),N(URL.createObjectURL(s)))};return H?e.jsxs("div",{className:"flex flex-col gap-6 p-4",children:[e.jsx(D,{title:"Message du Maire"}),e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"text-gray-500",children:"Chargement des messages..."})})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-col gap-6 p-4",children:[e.jsx(D,{title:"Message du Maire"}),e.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex h-10 w-10 items-center justify-center rounded-lg bg-green-100",children:e.jsx(E,{className:"h-5 w-5 text-[#03800a]"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Message du Maire"}),e.jsx("p",{className:"text-sm text-gray-500",children:'Gestion du message affiché sur la page "Message du Maire". Un seul message peut être actif.'})]})]}),e.jsxs("button",{onClick:()=>{h(),d(!0)},className:"inline-flex items-center gap-2 rounded-lg bg-[#03800a] px-4 py-2 text-sm font-semibold text-white shadow-sm hover:bg-green-700 transition-colors",children:[e.jsx(ie,{className:"h-4 w-4"}),"Nouveau message"]})]}),e.jsx("div",{className:"rounded-xl border border-gray-200 bg-white shadow-sm",children:S.length===0?e.jsxs("div",{className:"p-12 text-center",children:[e.jsx(E,{className:"mx-auto h-12 w-12 text-[#03800a]"}),e.jsx("h3",{className:"mt-4 text-lg font-semibold text-gray-900",children:"Aucun message"}),e.jsx("p",{className:"mt-2 text-sm text-gray-500",children:"Commencez par créer un message du maire"})]}):e.jsx("div",{className:"divide-y divide-gray-200",children:S.map(t=>e.jsxs("div",{className:`flex items-start gap-4 p-5 transition-colors hover:bg-gray-50 ${t.actif?"":"bg-gray-50/50"}`,children:[e.jsx("div",{className:"flex-shrink-0",children:t.photo_url?e.jsxs("button",{onClick:()=>I({open:!0,url:t.photo_url,title:t.nom_maire}),className:"relative group",children:[e.jsx("img",{src:t.photo_url,alt:t.nom_maire,className:"h-20 w-20 rounded-lg object-cover ring-2 ring-gray-200 group-hover:ring-[#03800a] transition-all"}),e.jsx("div",{className:"absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 transition-opacity rounded-lg flex items-center justify-center",children:e.jsx(ne,{className:"h-5 w-5 text-white"})})]}):e.jsx("div",{className:"h-20 w-20 rounded-lg bg-gray-100 flex items-center justify-center",children:e.jsx(E,{className:"h-8 w-8 text-gray-400"})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h3",{className:"text-base font-semibold text-gray-900",children:t.titre_vision}),t.actif?e.jsx("span",{className:"inline-flex items-center rounded-full bg-green-100 px-2.5 py-0.5 text-xs font-medium text-green-800",children:"Actif"}):e.jsx("span",{className:"inline-flex items-center rounded-full bg-gray-100 px-2.5 py-0.5 text-xs font-medium text-gray-600",children:"Inactif"})]}),e.jsxs("p",{className:"text-sm font-medium text-gray-700",children:[t.nom_maire," — ",t.titre_maire]}),e.jsx("p",{className:"text-sm text-gray-500 mt-1 line-clamp-2",children:t.contenu_message}),t.citation&&e.jsxs("p",{className:"text-xs text-gray-400 mt-1 italic",children:['"',t.citation,'"']})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[e.jsx("button",{onClick:()=>V(t.id),className:`rounded p-2 transition-colors ${t.actif?"text-green-600 hover:bg-green-50":"text-gray-400 hover:bg-gray-100"}`,title:t.actif?"Désactiver":"Activer",children:t.actif?e.jsx(me,{className:"h-5 w-5"}):e.jsx(ce,{className:"h-5 w-5"})}),e.jsx("button",{onClick:()=>W(t),className:"rounded p-2 text-blue-600 hover:bg-blue-50 transition-colors",title:"Modifier",children:e.jsx(oe,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>G(t.id),className:"rounded p-2 text-red-600 hover:bg-red-50 transition-colors",title:"Supprimer",children:e.jsx(se,{className:"h-4 w-4"})})]})]},t.id))})})]}),$&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-start justify-center bg-black/40 px-4 overflow-y-auto py-6",children:e.jsxs("div",{className:"w-full max-w-3xl rounded-2xl bg-white shadow-2xl my-4",children:[e.jsxs("div",{className:"flex items-center justify-between border-b px-6 py-4",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-xs uppercase tracking-wide text-gray-500",children:[c?"Modifier":"Nouveau"," message"]}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:c?"Modifier le message du maire":"Créer un message du maire"})]}),e.jsx("button",{onClick:()=>{d(!1),h()},className:"rounded-full p-2 text-gray-500 hover:bg-gray-100",children:e.jsx(te,{className:"h-5 w-5"})})]}),e.jsxs("form",{className:"space-y-4 px-6 py-5",onSubmit:z,children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Nom du maire *"}),e.jsx("input",{required:!0,value:r.nom_maire,onChange:t=>n({...r,nom_maire:t.target.value}),className:"mt-1 w-full rounded-lg border border-gray-200 px-3 py-2 focus:border-[#03800a] focus:outline-none focus:ring-2 focus:ring-green-200",placeholder:"Ex: François Albert AMICHIA"}),i.nom_maire?.[0]&&e.jsx("p",{className:"mt-1 text-xs text-red-600",children:i.nom_maire[0]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Titre / Fonction *"}),e.jsx("input",{required:!0,value:r.titre_maire,onChange:t=>n({...r,titre_maire:t.target.value}),className:"mt-1 w-full rounded-lg border border-gray-200 px-3 py-2 focus:border-[#03800a] focus:outline-none focus:ring-2 focus:ring-green-200",placeholder:"Ex: Maire de Treichville"}),i.titre_maire?.[0]&&e.jsx("p",{className:"mt-1 text-xs text-red-600",children:i.titre_maire[0]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Titre de la vision *"}),e.jsx("input",{required:!0,value:r.titre_vision,onChange:t=>n({...r,titre_vision:t.target.value}),className:"mt-1 w-full rounded-lg border border-gray-200 px-3 py-2 focus:border-[#03800a] focus:outline-none focus:ring-2 focus:ring-green-200",placeholder:"Ex: Vision 2025-2030"}),i.titre_vision?.[0]&&e.jsx("p",{className:"mt-1 text-xs text-red-600",children:i.titre_vision[0]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Salutation *"}),e.jsx("input",{required:!0,value:r.salutation,onChange:t=>n({...r,salutation:t.target.value}),className:"mt-1 w-full rounded-lg border border-gray-200 px-3 py-2 focus:border-[#03800a] focus:outline-none focus:ring-2 focus:ring-green-200",placeholder:"Ex: Chères Treichvilloises, chers Treichvillois,"}),i.salutation?.[0]&&e.jsx("p",{className:"mt-1 text-xs text-red-600",children:i.salutation[0]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Contenu du message *"}),e.jsx("textarea",{required:!0,rows:8,value:r.contenu_message,onChange:t=>n({...r,contenu_message:t.target.value}),className:"mt-1 w-full rounded-lg border border-gray-200 px-3 py-2 focus:border-[#03800a] focus:outline-none focus:ring-2 focus:ring-green-200",placeholder:"Le corps du message du maire..."}),i.contenu_message?.[0]&&e.jsx("p",{className:"mt-1 text-xs text-red-600",children:i.contenu_message[0]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Texte de conclusion (optionnel)"}),e.jsx("textarea",{rows:3,value:r.texte_conclusion,onChange:t=>n({...r,texte_conclusion:t.target.value}),className:"mt-1 w-full rounded-lg border border-gray-200 px-3 py-2 focus:border-[#03800a] focus:outline-none focus:ring-2 focus:ring-green-200",placeholder:"Ex: Je m'engage à poursuivre..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Citation / Signature (optionnel)"}),e.jsx("input",{value:r.citation,onChange:t=>n({...r,citation:t.target.value}),className:"mt-1 w-full rounded-lg border border-gray-200 px-3 py-2 focus:border-[#03800a] focus:outline-none focus:ring-2 focus:ring-green-200",placeholder:"Ex: Ensemble, bâtissons une Treichville moderne..."})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Photo du maire"}),q&&e.jsx("div",{className:"mt-2 mb-3",children:e.jsx("img",{src:q,alt:"Aperçu photo",className:"h-32 w-32 rounded-lg object-cover border-2 border-green-200"})}),e.jsxs("label",{className:"mt-2 flex cursor-pointer items-center gap-2 rounded-lg border-2 border-dashed border-gray-300 px-4 py-3 hover:border-[#03800a] hover:bg-green-50 transition-colors",children:[e.jsx(U,{className:"h-5 w-5 text-gray-500"}),e.jsx("span",{className:"text-sm text-gray-600",children:"Choisir une photo"}),e.jsx("input",{type:"file",accept:"image/*",onChange:B,ref:m,className:"hidden"})]}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Format image, max 10 Mo"}),i.photo?.[0]&&e.jsx("p",{className:"mt-1 text-xs text-red-600",children:i.photo[0]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Image de fond"}),L&&e.jsx("div",{className:"mt-2 mb-3",children:e.jsx("img",{src:L,alt:"Aperçu image de fond",className:"h-32 w-full rounded-lg object-cover border-2 border-green-200"})}),e.jsxs("label",{className:"mt-2 flex cursor-pointer items-center gap-2 rounded-lg border-2 border-dashed border-gray-300 px-4 py-3 hover:border-[#03800a] hover:bg-green-50 transition-colors",children:[e.jsx(U,{className:"h-5 w-5 text-gray-500"}),e.jsx("span",{className:"text-sm text-gray-600",children:"Choisir une image de fond"}),e.jsx("input",{type:"file",accept:"image/*",onChange:Q,ref:u,className:"hidden"})]}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Format image, max 10 Mo"}),i.image_fond?.[0]&&e.jsx("p",{className:"mt-1 text-xs text-red-600",children:i.image_fond[0]})]})]}),e.jsxs("div",{className:"flex items-center gap-3 rounded-lg bg-amber-50 border border-amber-200 px-4 py-3",children:[e.jsx("input",{type:"checkbox",id:"actif",checked:r.actif,onChange:t=>n({...r,actif:t.target.checked}),className:"h-4 w-4 rounded border-gray-300 text-[#03800a] focus:ring-[#03800a]"}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"actif",className:"text-sm font-medium text-gray-700",children:"Activer ce message"}),e.jsx("p",{className:"text-xs text-amber-700",children:"Un seul message peut être actif à la fois. Activer celui-ci désactivera les autres."})]})]}),e.jsxs("div",{className:"flex items-center justify-end gap-3 border-t pt-4",children:[e.jsx("button",{type:"button",onClick:()=>{d(!1),h()},className:"rounded-lg px-4 py-2 text-sm font-semibold text-gray-600 hover:bg-gray-100",children:"Annuler"}),e.jsx("button",{type:"submit",disabled:k,className:"rounded-lg bg-[#03800a] px-5 py-2 text-sm font-semibold text-white shadow-sm hover:bg-green-700 disabled:opacity-60",children:k?"Enregistrement...":"Enregistrer"})]})]})]})}),e.jsx(re,{open:f.open,onClose:()=>j({open:!1,id:null}),onConfirm:J,title:"Supprimer ce message ?",message:"Cette action est irréversible. Le message du maire sera définitivement supprimé.",confirmText:"Supprimer",type:"danger",loading:K}),e.jsx(ae,{open:b.open,onClose:()=>I({open:!1,url:"",title:""}),imageUrl:b.url,title:b.title})]})};ue.layout=o=>e.jsx(Z,{children:o});export{ue as default};
