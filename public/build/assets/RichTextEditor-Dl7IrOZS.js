import{r as i,j as m}from"./app-zp8a_1Kz.js";const w="https://cdn.ckeditor.com/ckeditor5/41.4.2/classic/ckeditor.js";class b{loader;onSuccess;onError;constructor(e){this.loader=e}async upload(){try{const e=await this.loader.file;if(e.size>4*1024*1024)throw new Error("L'image est trop volumineuse (max 4 Mo)");if(!e.type.startsWith("image/"))throw new Error("Le fichier doit Ãªtre une image");const s=new FormData;s.append("image",e);const c=document.querySelector('meta[name="csrf-token"]')?.content,t=await fetch("/admin/api/upload-editor-image",{method:"POST",headers:{"X-CSRF-TOKEN":c||"","X-Requested-With":"XMLHttpRequest"},body:s});if(!t.ok){const l=await t.json();throw new Error(l.message||"Erreur lors de l'upload")}return{default:(await t.json()).url}}catch(e){throw console.error("Erreur upload CKEditor:",e),e}}abort(){}}function h(r){r.plugins.get("FileRepository").createUploadAdapter=e=>new b(e)}function R({value:r,onChange:e,placeholder:s}){const c=i.useRef(null),t=i.useRef(null),d=i.useRef(r),[l,p]=i.useState(!1),[E,u]=i.useState(!1),g=i.useRef(e);return i.useEffect(()=>{g.current=e},[e]),i.useEffect(()=>{let n=!0;async function f(){if(!(!n||!c.current||t.current||E)&&window.ClassicEditor)try{u(!0);const o=await window.ClassicEditor.create(c.current,{placeholder:s,extraPlugins:[h],toolbar:{items:["heading","|","bold","italic","link","bulletedList","numberedList","|","outdent","indent","|","imageUpload","blockQuote","insertTable","mediaEmbed","undo","redo"]},image:{toolbar:["imageTextAlternative","imageStyle:inline","imageStyle:block","imageStyle:side"]},table:{contentToolbar:["tableColumn","tableRow","mergeTableCells"]}});if(!n){o.destroy().catch(()=>{});return}t.current=o,o.setData(r||""),o.model.document.on("change:data",()=>{const a=o.getData();d.current=a,g.current(a)})}catch(o){console.error("Erreur initialisation CKEditor:",o),n&&(p(!0),u(!1))}}if(window.ClassicEditor)f();else{const o=document.querySelector(`script[src="${w}"]`);if(o)o.addEventListener("load",()=>{n&&f()});else{const a=document.createElement("script");a.src=w,a.async=!0,a.onload=()=>{n&&f()},a.onerror=()=>{n&&p(!0)},document.body.appendChild(a)}}return()=>{n=!1,t.current&&(t.current.destroy().catch(()=>{}),t.current=null),u(!1)}},[]),i.useEffect(()=>{t.current&&r!==d.current&&(t.current.setData(r||""),d.current=r)},[r]),l?m.jsx("textarea",{value:r,onChange:n=>e(n.target.value),placeholder:s,className:"mt-1 w-full rounded-lg border border-gray-200 px-3 py-2 focus:border-indigo-500 focus:outline-none focus:ring-2 focus:ring-indigo-100",rows:8}):m.jsx("div",{className:"ckeditor-container",children:m.jsx("div",{ref:c,className:"prose prose-sm max-w-none"})})}export{R};
