import{r,j as e,H as K}from"./app-CxsUZNRk.js";import{A as W}from"./app-layout-C-eYnInK.js";import{u as z,X as G}from"./NotificationContainer-ClRgWa5q.js";import{T as J,C as Q}from"./ConfirmDialog-gGBzzmkd.js";import{I as V}from"./ImagePreviewModal-Dqm8FkXl.js";import{R as Y}from"./RichTextEditor-CRq2a75b.js";import{P as Z}from"./plus-BaUCHKjA.js";import{I as x}from"./image-Cf2rINOg.js";import{S as ee}from"./square-pen-B5tKWO7h.js";/* empty css            */import"./utils-CWpWFhVN.js";import"./button-B5cEFkY0.js";import"./index-BViRWBSq.js";import"./index-DzWG0LfO.js";import"./proxy-nIHRNzfy.js";import"./index-w_94M6Cx.js";import"./index-CMWG4mbA.js";import"./book-open-DZqK2S_K.js";import"./megaphone-BMpck1R8.js";import"./tag-BnB9tJi7.js";import"./users-B-O3NJjx.js";import"./chevron-right-CHSGYyhq.js";import"./download-CmvFp7GU.js";const te=["home","message-maire","conseil-municipal"],se=["welcome","identity","stats","intro"],re=()=>{const{addNotification:i}=z(),[N,R]=r.useState([]),[q,B]=r.useState(!0),[O,c]=r.useState(!1),[v,w]=r.useState(!1),[d,k]=r.useState(null),[g,p]=r.useState({open:!1,id:null}),[L,C]=r.useState(!1),[f,u]=r.useState({open:!1,url:"",title:""}),[s,l]=r.useState({page:"",section_key:"",title:"",content:"",cta_text:"",cta_link:"",ordre:"0",actif:!0}),[S,_]=r.useState(null),[E,I]=r.useState(null),[A,h]=r.useState(null),[F,b]=r.useState(null);r.useEffect(()=>{y()},[]);const y=async()=>{try{const a=await(await fetch("/admin/api/content-blocks")).json();R(a.data||[])}catch(t){console.error(t),i("error","Impossible de charger les blocs")}finally{B(!1)}},T=()=>{l({page:"",section_key:"",title:"",content:"",cta_text:"",cta_link:"",ordre:"0",actif:!0}),_(null),I(null),h(null),b(null),k(null)},X=t=>{l({page:t.page,section_key:t.section_key,title:t.title||"",content:t.content||"",cta_text:t.cta_text||"",cta_link:t.cta_link||"",ordre:String(t.ordre??0),actif:t.actif}),h(t.image_url||null),b(t.background_image_url||null),k(t.id),c(!0)},$=async t=>{t.preventDefault(),w(!0);try{const a=document.querySelector('meta[name="csrf-token"]')?.content??"",n=new FormData;Object.entries(s).forEach(([m,P])=>{m==="actif"?n.append(m,P?"1":"0"):n.append(m,P??"")}),S&&n.append("image",S),E&&n.append("background_image",E);const o=d?`/admin/api/content-blocks/${d}`:"/admin/api/content-blocks";d&&n.append("_method","PUT");const j=await fetch(o,{method:"POST",headers:{"X-CSRF-TOKEN":a,"X-Requested-With":"XMLHttpRequest"},body:n});if(!j.ok){const m=await j.json();throw new Error(m.message||"Erreur de sauvegarde")}const U=await j.json();i("success",U.message||(d?"Bloc modifié":"Bloc créé")),await y(),c(!1),T()}catch(a){console.error(a),i("error",a instanceof Error?a.message:"Impossible de sauvegarder le bloc")}finally{w(!1)}},M=t=>{p({open:!0,id:t})},H=async()=>{if(g.id){C(!0);try{const t=document.querySelector('meta[name="csrf-token"]')?.content??"",a=await fetch(`/admin/api/content-blocks/${g.id}`,{method:"DELETE",headers:{"X-CSRF-TOKEN":t,"X-Requested-With":"XMLHttpRequest"}});if(!a.ok){const o=await a.json();throw new Error(o.message||"Erreur de suppression")}const n=await a.json();i("success",n.message||"Bloc supprimé"),await y(),p({open:!1,id:null})}catch(t){console.error(t),i("error",t instanceof Error?t.message:"Impossible de supprimer le bloc")}finally{C(!1)}}},D=(t,a)=>{const n=t.target.files?.[0];if(!n)return;const o=new FileReader;o.onloadend=()=>{a==="image"?(_(n),h(o.result)):(I(n),b(o.result))},o.readAsDataURL(n)};return e.jsxs("div",{className:"flex flex-col gap-6 p-4",children:[e.jsx(K,{title:"Blocs de contenu"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm uppercase tracking-wide text-gray-500",children:"Apparence"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Blocs de contenu"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Gérer les images et contenus dynamiques par section."})]}),e.jsxs("button",{onClick:()=>{T(),c(!0)},className:"inline-flex items-center gap-2 rounded-lg bg-[#03800a] px-4 py-2 text-sm font-semibold text-white shadow-sm hover:bg-[#166e7b]",children:[e.jsx(Z,{className:"h-4 w-4"}),"Nouveau bloc"]})]}),e.jsx("div",{className:"rounded-xl border border-gray-200 bg-white p-0 shadow-sm",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-50 text-left text-xs uppercase text-gray-500",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3",children:"Page"}),e.jsx("th",{className:"px-4 py-3",children:"Section"}),e.jsx("th",{className:"px-4 py-3",children:"Titre"}),e.jsx("th",{className:"px-4 py-3",children:"Ordre"}),e.jsx("th",{className:"px-4 py-3",children:"Actif"}),e.jsx("th",{className:"px-4 py-3",children:"Images"}),e.jsx("th",{className:"px-4 py-3",children:"Actions"})]})}),e.jsx("tbody",{children:q?e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"px-4 py-4 text-center text-gray-500",children:"Chargement..."})}):N.length?N.map(t=>e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"px-4 py-3 font-medium text-gray-900",children:t.page}),e.jsx("td",{className:"px-4 py-3 text-gray-700",children:t.section_key}),e.jsx("td",{className:"px-4 py-3 text-gray-700",children:t.title||"—"}),e.jsx("td",{className:"px-4 py-3 text-gray-700",children:t.ordre}),e.jsx("td",{className:"px-4 py-3 text-gray-700",children:t.actif?"Oui":"Non"}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[t.image_url&&e.jsxs("button",{type:"button",className:"inline-flex items-center gap-1 rounded-lg border border-gray-200 px-2 py-1 text-xs text-gray-700 hover:bg-gray-100",onClick:()=>u({open:!0,url:t.image_url||"",title:`${t.page} / ${t.section_key} (image)`}),children:[e.jsx(x,{className:"h-3.5 w-3.5"}),"Image"]}),t.background_image_url&&e.jsxs("button",{type:"button",className:"inline-flex items-center gap-1 rounded-lg border border-gray-200 px-2 py-1 text-xs text-gray-700 hover:bg-gray-100",onClick:()=>u({open:!0,url:t.background_image_url||"",title:`${t.page} / ${t.section_key} (fond)`}),children:[e.jsx(x,{className:"h-3.5 w-3.5"}),"Fond"]}),!t.image_url&&!t.background_image_url&&"—"]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>X(t),className:"inline-flex items-center gap-1 rounded-lg border border-gray-200 px-2 py-1 text-xs text-gray-700 hover:bg-gray-100",children:[e.jsx(ee,{className:"h-3.5 w-3.5"}),"Éditer"]}),e.jsxs("button",{onClick:()=>M(t.id),className:"inline-flex items-center gap-1 rounded-lg border border-red-200 px-2 py-1 text-xs text-red-600 hover:bg-red-50",children:[e.jsx(J,{className:"h-3.5 w-3.5"}),"Supprimer"]})]})})]},t.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"px-4 py-6 text-center text-gray-500",children:"Aucun bloc pour le moment."})})})]})})}),O&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40 px-4",children:e.jsxs("div",{className:"w-full max-w-2xl rounded-2xl bg-white shadow-2xl",children:[e.jsxs("div",{className:"flex items-center justify-between border-b px-6 py-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-wide text-gray-500",children:"Bloc de contenu"}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:d?"Éditer le bloc":"Nouveau bloc"})]}),e.jsx("button",{className:"rounded-full p-2 text-gray-500 hover:bg-gray-100",onClick:()=>c(!1),children:e.jsx(G,{className:"h-5 w-5"})})]}),e.jsxs("form",{className:"space-y-4 px-6 py-5",onSubmit:$,children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Page *"}),e.jsx("input",{required:!0,value:s.page,onChange:t=>l({...s,page:t.target.value}),list:"page-suggestions",className:"mt-1 w-full rounded-lg border border-gray-200 px-3 py-2 focus:border-[#03800a] focus:outline-none focus:ring-2 focus:ring-[#03800a]/20",placeholder:"home, message-maire..."}),e.jsx("datalist",{id:"page-suggestions",children:te.map(t=>e.jsx("option",{value:t},t))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Section *"}),e.jsx("input",{required:!0,value:s.section_key,onChange:t=>l({...s,section_key:t.target.value}),list:"section-suggestions",className:"mt-1 w-full rounded-lg border border-gray-200 px-3 py-2 focus:border-[#03800a] focus:outline-none focus:ring-2 focus:ring-[#03800a]/20",placeholder:"welcome, stats, intro..."}),e.jsx("datalist",{id:"section-suggestions",children:se.map(t=>e.jsx("option",{value:t},t))})]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Titre"}),e.jsx("input",{value:s.title,onChange:t=>l({...s,title:t.target.value}),className:"mt-1 w-full rounded-lg border border-gray-200 px-3 py-2 focus:border-[#03800a] focus:outline-none focus:ring-2 focus:ring-[#03800a]/20",placeholder:"Titre (optionnel)"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Ordre"}),e.jsx("input",{type:"number",min:0,value:s.ordre,onChange:t=>l({...s,ordre:t.target.value}),className:"mt-1 w-full rounded-lg border border-gray-200 px-3 py-2 focus:border-[#03800a] focus:outline-none focus:ring-2 focus:ring-[#03800a]/20"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Contenu"}),e.jsx(Y,{value:s.content,onChange:t=>l({...s,content:t})})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"CTA (texte)"}),e.jsx("input",{value:s.cta_text,onChange:t=>l({...s,cta_text:t.target.value}),className:"mt-1 w-full rounded-lg border border-gray-200 px-3 py-2 focus:border-[#03800a] focus:outline-none focus:ring-2 focus:ring-[#03800a]/20",placeholder:"Ex: Découvrir"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"CTA (lien)"}),e.jsx("input",{value:s.cta_link,onChange:t=>l({...s,cta_link:t.target.value}),className:"mt-1 w-full rounded-lg border border-gray-200 px-3 py-2 focus:border-[#03800a] focus:outline-none focus:ring-2 focus:ring-[#03800a]/20",placeholder:"/services ou #services"})]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Image principale"}),e.jsx("input",{type:"file",accept:"image/*",onChange:t=>D(t,"image"),className:"mt-1 w-full rounded-lg border border-gray-200 px-3 py-2 focus:border-[#03800a] focus:outline-none focus:ring-2 focus:ring-[#03800a]/20"}),A&&e.jsxs("button",{type:"button",onClick:()=>u({open:!0,url:A,title:"Apercu image"}),className:"mt-2 inline-flex items-center gap-2 text-xs text-[#03800a] hover:underline",children:[e.jsx(x,{className:"h-4 w-4"}),"Apercu image"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Image de fond"}),e.jsx("input",{type:"file",accept:"image/*",onChange:t=>D(t,"background"),className:"mt-1 w-full rounded-lg border border-gray-200 px-3 py-2 focus:border-[#03800a] focus:outline-none focus:ring-2 focus:ring-[#03800a]/20"}),F&&e.jsxs("button",{type:"button",onClick:()=>u({open:!0,url:F,title:"Apercu fond"}),className:"mt-2 inline-flex items-center gap-2 text-xs text-[#03800a] hover:underline",children:[e.jsx(x,{className:"h-4 w-4"}),"Apercu fond"]})]})]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm text-gray-700",children:[e.jsx("input",{type:"checkbox",checked:s.actif,onChange:t=>l({...s,actif:t.target.checked}),className:"h-4 w-4 rounded border-gray-300 text-[#03800a] focus:ring-[#03800a]"}),"Actif"]}),e.jsxs("div",{className:"flex items-center justify-end gap-3 border-t pt-4",children:[e.jsx("button",{type:"button",className:"rounded-lg px-4 py-2 text-sm font-semibold text-gray-600 hover:bg-gray-100",onClick:()=>c(!1),children:"Annuler"}),e.jsx("button",{type:"submit",disabled:v,className:"rounded-lg bg-[#03800a] px-5 py-2 text-sm font-semibold text-white shadow-sm hover:bg-[#166e7b] disabled:opacity-60",children:v?"Enregistrement...":"Enregistrer"})]})]})]})}),e.jsx(Q,{open:g.open,onClose:()=>p({open:!1,id:null}),onConfirm:H,title:"Supprimer ce bloc ?",message:"Cette action est irreversible. Le bloc sera definitivement supprime.",type:"danger",loading:L}),e.jsx(V,{open:f.open,onClose:()=>u({open:!1,url:"",title:""}),imageUrl:f.url,title:f.title})]})};re.layout=i=>e.jsx(W,{children:i});export{re as default};
