import{r as a,j as e,H as C}from"./app-ku5FKtMI.js";import{A as S}from"./app-layout-gPpE1N9p.js";import{R as _}from"./RichTextEditor-C0bJuWcc.js";import{P as E}from"./plus-BgLcY-vC.js";import{X as A}from"./NotificationContainer-qJBbjeHa.js";/* empty css            */import"./utils-DA266S2W.js";import"./button-BovM7XrU.js";import"./index-CJzxzxTs.js";import"./index-8awesiKm.js";import"./proxy-CgHAwada.js";import"./index-2yvp8cuD.js";import"./index-CMWG4mbA.js";import"./megaphone-R9BqEd6o.js";import"./tag-CyCxdM0o.js";import"./book-open-OAstdG-6.js";import"./chevron-right-BtsZ4e_w.js";const k=()=>{const[n,x]=a.useState([]),[f,j]=a.useState(!0),[y,o]=a.useState(!1),[m,p]=a.useState(!1),[b,N]=a.useState([]),[s,r]=a.useState({titre:"",categorie:"",category_id:"",status:"published",published_at:"",description:"",contenu:""}),[h,g]=a.useState(null);a.useEffect(()=>{(async()=>{try{const i=await(await fetch("/admin/api/actualites")).json();x(i.data||[]);const d=await(await fetch("/admin/api/categories?type=actualite")).json();N(d.data||[])}catch(l){console.error(l)}finally{j(!1)}})()},[]);const v=async t=>{t.preventDefault(),p(!0);try{const l=document.querySelector('meta[name="csrf-token"]')?.content??"",i=new FormData;Object.entries(s).forEach(([u,w])=>i.append(u,w??"")),h&&i.append("image",h);const c=await fetch("/admin/api/actualites",{method:"POST",headers:{"X-CSRF-TOKEN":l,"X-Requested-With":"XMLHttpRequest"},body:i});if(!c.ok)throw new Error("Erreur de création");const d=await c.json();x(u=>[d.data,...u]),o(!1),r({titre:"",categorie:"",category_id:"",status:"published",published_at:"",description:"",contenu:""}),g(null)}catch(l){console.error(l),alert("Impossible de créer l'actualité. Vérifie les champs obligatoires.")}finally{p(!1)}};return e.jsxs("div",{className:"flex flex-col gap-6 p-4",children:[e.jsx(C,{title:"Actualités"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm uppercase tracking-wide text-gray-500",children:"Contenu"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Actualités"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Liste des articles déjà saisis. Ajouter/éditer à connecter ensuite."})]}),e.jsxs("button",{onClick:()=>o(!0),className:"inline-flex items-center gap-2 rounded-lg bg-[#03800a] px-4 py-2 text-sm font-semibold text-white shadow-sm hover:bg-[#166e7b]",children:[e.jsx(E,{className:"h-4 w-4"}),"Nouvelle actualité"]})]}),e.jsx("div",{className:"rounded-xl border border-gray-200 bg-white p-0 shadow-sm",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-50 text-left text-xs uppercase text-gray-500",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3",children:"Titre"}),e.jsx("th",{className:"px-4 py-3",children:"Catégorie"}),e.jsx("th",{className:"px-4 py-3",children:"Statut"}),e.jsx("th",{className:"px-4 py-3",children:"Publié le"})]})}),e.jsx("tbody",{children:f?e.jsx("tr",{children:e.jsx("td",{colSpan:4,className:"px-4 py-4 text-center text-gray-500",children:"Chargement..."})}):n.length?n.map(t=>e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"px-4 py-3 font-medium text-gray-900",children:t.titre}),e.jsx("td",{className:"px-4 py-3 text-gray-700",children:t.categorie||"—"}),e.jsx("td",{className:"px-4 py-3 text-gray-700",children:t.status||"draft"}),e.jsx("td",{className:"px-4 py-3 text-gray-700",children:t.published_at?new Date(t.published_at).toLocaleDateString():"—"})]},t.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:4,className:"px-4 py-6 text-center text-gray-500",children:"Aucune actualité pour le moment."})})})]})})}),y&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40 px-4",children:e.jsxs("div",{className:"w-full max-w-2xl rounded-2xl bg-white shadow-2xl",children:[e.jsxs("div",{className:"flex items-center justify-between border-b px-6 py-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-wide text-gray-500",children:"Nouvelle actualité"}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Créer un article"})]}),e.jsx("button",{className:"rounded-full p-2 text-gray-500 hover:bg-gray-100",onClick:()=>o(!1),children:e.jsx(A,{className:"h-5 w-5"})})]}),e.jsxs("form",{className:"space-y-4 px-6 py-5",onSubmit:v,children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Titre *"}),e.jsx("input",{required:!0,value:s.titre,onChange:t=>r({...s,titre:t.target.value}),className:"mt-1 w-full rounded-lg border border-gray-200 px-3 py-2 focus:border-[#03800a] focus:outline-none focus:ring-2 focus:ring-[#03800a]/20",placeholder:"Titre de l’article"})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Catégorie"}),e.jsxs("select",{value:s.category_id,onChange:t=>r({...s,category_id:t.target.value,categorie:""}),className:"mt-1 w-full rounded-lg border border-gray-200 px-3 py-2 focus:border-[#03800a] focus:outline-none focus:ring-2 focus:ring-[#03800a]/20",children:[e.jsx("option",{value:"",children:"Sélectionner"}),b.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Catégories limitées au type Actualité."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Publié le"}),e.jsx("input",{type:"date",value:s.published_at,onChange:t=>r({...s,published_at:t.target.value}),className:"mt-1 w-full rounded-lg border border-gray-200 px-3 py-2 focus:border-[#03800a] focus:outline-none focus:ring-2 focus:ring-[#03800a]/20"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Statut"}),e.jsxs("select",{value:s.status,onChange:t=>r({...s,status:t.target.value}),className:"mt-1 w-full rounded-lg border border-gray-200 px-3 py-2 focus:border-[#03800a] focus:outline-none focus:ring-2 focus:ring-[#03800a]/20",children:[e.jsx("option",{value:"published",children:"Publié"}),e.jsx("option",{value:"draft",children:"Brouillon"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Description courte"}),e.jsx("textarea",{value:s.description,onChange:t=>r({...s,description:t.target.value}),rows:3,className:"mt-1 w-full rounded-lg border border-gray-200 px-3 py-2 focus:border-[#03800a] focus:outline-none focus:ring-2 focus:ring-[#03800a]/20",placeholder:"Résumé affiché sur la carte"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Contenu (CKEditor)"}),e.jsx(_,{value:s.contenu,onChange:t=>r({...s,contenu:t}),placeholder:"Saisir l’article complet"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Image principale"}),e.jsx("input",{type:"file",accept:"image/*",onChange:t=>g(t.target.files?.[0]??null),className:"mt-1 w-full rounded-lg border border-gray-200 px-3 py-2 focus:border-[#03800a] focus:outline-none focus:ring-2 focus:ring-[#03800a]/20"}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Formats image, max 4 Mo."})]}),e.jsxs("div",{className:"flex items-center justify-end gap-3 border-t pt-4",children:[e.jsx("button",{type:"button",className:"rounded-lg px-4 py-2 text-sm font-semibold text-gray-600 hover:bg-gray-100",onClick:()=>o(!1),children:"Annuler"}),e.jsx("button",{type:"submit",disabled:m,className:"rounded-lg bg-[#03800a] px-5 py-2 text-sm font-semibold text-white shadow-sm hover:bg-[#166e7b] disabled:opacity-60",children:m?"Enregistrement...":"Enregistrer"})]})]})]})})]})};k.layout=n=>e.jsx(S,{children:n});export{k as default};
