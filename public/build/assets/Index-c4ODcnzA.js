import{u as q,r as i,j as e,H as M}from"./app-utgbfNX0.js";import{l as d,a as X,L as H}from"./listing-BgDoC534.js";import{L as I}from"./ListingToolbar-D_oC9UU_.js";import{A as U}from"./app-layout-CFfPYMJg.js";import{u as B}from"./use-listing-search-CM3TCGL3.js";import{u as $,X as z}from"./NotificationContainer-CfokcVx5.js";import{T as K,C as V}from"./ConfirmDialog-CAlrluB8.js";import{R as W}from"./RichTextEditor-Du5b9XL7.js";import{P as G}from"./plus-LDc-pGbY.js";import{S as J}from"./square-pen-B0q-z-OZ.js";/* empty css            */import"./utils-LNTPob9H.js";import"./button-Diin00ly.js";import"./index-TFK0zwhy.js";import"./index-x6Y8e2MX.js";import"./proxy-C2tPMP2D.js";import"./index-w_94M6Cx.js";import"./index-CMWG4mbA.js";import"./book-open-C0we6ypj.js";import"./megaphone-CmI5EizT.js";import"./landmark-ikN-vJEZ.js";import"./tag-C7YTYvmc.js";import"./users-DSNz5R3n.js";import"./chevron-right-CcxNG9WG.js";const Q=[{value:"",label:"Aucune"},{value:"FileText",label:"Document"},{value:"Users",label:"Utilisateurs"},{value:"Building",label:"Bâtiment"},{value:"Home",label:"Maison"},{value:"Sprout",label:"Nature"},{value:"Heart",label:"Social"},{value:"Briefcase",label:"Portefeuille"},{value:"Coins",label:"Finances"},{value:"Calendar",label:"Agenda"},{value:"MapPin",label:"Localisation"},{value:"PhoneCall",label:"Contacts"}],Y=({directions:u=[],listing:p})=>{const{addNotification:x}=$(),{url:_}=q(),o=_.split("?")[0],[h,P]=i.useState(p?.filters.search??""),f=p?.filters.sort??"ordre",b=p?.filters.direction??"asc",l=p?.pagination??{page:1,per_page:15,total:u.length,last_page:1},n=i.useMemo(()=>({search:h,sort:f,direction:b,per_page:l.per_page}),[l.per_page,h,b,f]);B(o,n);const[k,m]=i.useState(!1),[C,S]=i.useState(!1),[c,E]=i.useState(null),[j,y]=i.useState({open:!1,id:null}),[A,D]=i.useState(!1),[r,a]=i.useState({nom:"",short_description:"",contenu:"",icon:"",responsable:"",adresse:"",ordre:"0",actif:!0}),g=()=>{a({nom:"",short_description:"",contenu:"",icon:"",responsable:"",adresse:"",ordre:"0",actif:!0}),E(null)},R=s=>{a({nom:s.nom??"",short_description:s.short_description??s.description??"",contenu:s.contenu??"",icon:s.icon??"",responsable:s.responsable??"",adresse:s.adresse??"",ordre:String(s.ordre??0),actif:s.actif??!0}),E(s.id),m(!0)},T=async s=>{s.preventDefault(),S(!0);try{const t=document.querySelector('meta[name="csrf-token"]')?.content??"",v={nom:r.nom,description:r.short_description,short_description:r.short_description,contenu:r.contenu,icon:r.icon||null,responsable:r.responsable||null,adresse:r.adresse||null,ordre:Number(r.ordre||0),actif:r.actif?1:0},N=c?`/admin/api/directions/${c}`:"/admin/api/directions",w=await fetch(N,{method:c?"PUT":"POST",headers:{"X-CSRF-TOKEN":t,"X-Requested-With":"XMLHttpRequest","Content-Type":"application/json"},body:JSON.stringify(v)});if(!w.ok){const F=await w.json();throw new Error(F.message||"Erreur de sauvegarde")}const O=await w.json();x("success",O.message||(c?"Direction mise à jour":"Direction créée")),m(!1),g(),d(o,{...n,page:1})}catch(t){console.error(t),x("error",t instanceof Error?t.message:"Impossible de sauvegarder la direction")}finally{S(!1)}},L=async()=>{if(j.id){D(!0);try{const s=document.querySelector('meta[name="csrf-token"]')?.content??"",t=await fetch(`/admin/api/directions/${j.id}`,{method:"DELETE",headers:{"X-CSRF-TOKEN":s,"X-Requested-With":"XMLHttpRequest"}});if(!t.ok){const N=await t.json();throw new Error(N.message||"Erreur de suppression")}const v=await t.json();x("success",v.message||"Direction supprimée"),y({open:!1,id:null}),d(o,n)}catch(s){console.error(s),x("error",s instanceof Error?s.message:"Impossible de supprimer la direction")}finally{D(!1)}}};return e.jsxs("div",{className:"flex flex-col gap-6 p-4",children:[e.jsx(M,{title:"Directions"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm uppercase tracking-wide text-gray-500",children:"Organisation"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Directions"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Gérez les directions et leurs descriptions (courte + détaillée)."})]}),e.jsxs("button",{onClick:()=>{g(),m(!0)},className:"inline-flex items-center gap-2 rounded-lg bg-[#03800a] px-4 py-2 text-sm font-semibold text-white shadow-sm hover:bg-green-700",children:[e.jsx(G,{className:"h-4 w-4"}),"Nouvelle direction"]})]}),e.jsx(I,{search:h,perPage:l.per_page,sort:{value:f,direction:b},sortOptions:[{value:"ordre",label:"Ordre"},{value:"nom",label:"Nom"},{value:"created_at",label:"Créé le"}],onSearchChange:P,onSearchSubmit:()=>d(o,{...n,page:1}),onPerPageChange:s=>d(o,{...n,per_page:s,page:1}),onExport:s=>X(o,n,s),onSortChange:(s,t)=>d(o,{...n,sort:s,direction:t})}),e.jsx("div",{className:"rounded-xl border border-gray-200 bg-white shadow-sm",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-50 text-left text-xs uppercase text-gray-500",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3",children:"Nom"}),e.jsx("th",{className:"px-4 py-3",children:"Responsable"}),e.jsx("th",{className:"px-4 py-3",children:"Ordre"}),e.jsx("th",{className:"px-4 py-3",children:"Statut"}),e.jsx("th",{className:"px-4 py-3",children:"Actions"})]})}),e.jsx("tbody",{children:u.length?u.map(s=>e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"px-4 py-3 font-medium text-gray-900",children:s.nom}),e.jsx("td",{className:"px-4 py-3 text-gray-700",children:s.responsable??"—"}),e.jsx("td",{className:"px-4 py-3 text-gray-700",children:s.ordre??0}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:`inline-flex rounded-full px-2 py-1 text-xs font-semibold ${s.actif?"bg-green-100 text-green-700":"bg-gray-100 text-gray-700"}`,children:s.actif?"Actif":"Inactif"})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>R(s),className:"rounded p-2 text-blue-600 hover:bg-blue-50",title:"Éditer",children:e.jsx(J,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>y({open:!0,id:s.id}),className:"rounded p-2 text-red-600 hover:bg-red-50",title:"Supprimer",children:e.jsx(K,{className:"h-4 w-4"})})]})})]},s.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"px-4 py-6 text-center text-gray-500",children:"Aucune direction pour le moment."})})})]})})}),e.jsx(H,{page:l.page,lastPage:l.last_page,total:l.total,onPageChange:s=>d(o,{...n,page:s})}),k&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-start justify-center bg-black/40 px-4 py-6 overflow-y-auto",children:e.jsxs("div",{className:"w-full max-w-3xl rounded-2xl bg-white shadow-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between border-b px-6 py-4",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-xs uppercase tracking-wide text-gray-500",children:[c?"Modifier":"Nouvelle"," direction"]}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:c?"Modifier la direction":"Ajouter une direction"})]}),e.jsx("button",{onClick:()=>{m(!1),g()},className:"rounded-full p-2 text-gray-500 hover:bg-gray-100",children:e.jsx(z,{className:"h-5 w-5"})})]}),e.jsxs("form",{className:"space-y-4 px-6 py-5",onSubmit:T,children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Nom *"}),e.jsx("input",{required:!0,value:r.nom,onChange:s=>a({...r,nom:s.target.value}),className:"mt-1 w-full rounded-lg border border-gray-200 px-3 py-2 focus:border-[#03800a] focus:outline-none focus:ring-2 focus:ring-green-200",placeholder:"Ex: Direction des Affaires Administratives"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Responsable"}),e.jsx("input",{value:r.responsable,onChange:s=>a({...r,responsable:s.target.value}),className:"mt-1 w-full rounded-lg border border-gray-200 px-3 py-2 focus:border-[#03800a] focus:outline-none focus:ring-2 focus:ring-green-200",placeholder:"Nom et prénom"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Description courte"}),e.jsx("input",{value:r.short_description,onChange:s=>a({...r,short_description:s.target.value}),className:"mt-1 w-full rounded-lg border border-gray-200 px-3 py-2 focus:border-[#03800a] focus:outline-none focus:ring-2 focus:ring-green-200",placeholder:"Résumé court pour les cartes"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Description détaillée"}),e.jsx(W,{value:r.contenu,onChange:s=>a({...r,contenu:s})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Icône"}),e.jsx("select",{value:r.icon,onChange:s=>a({...r,icon:s.target.value}),className:"mt-1 w-full rounded-lg border border-gray-200 px-3 py-2 focus:border-[#03800a] focus:outline-none focus:ring-2 focus:ring-green-200",children:Q.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Adresse"}),e.jsx("input",{value:r.adresse,onChange:s=>a({...r,adresse:s.target.value}),className:"mt-1 w-full rounded-lg border border-gray-200 px-3 py-2 focus:border-[#03800a] focus:outline-none focus:ring-2 focus:ring-green-200",placeholder:"Adresse ou localisation"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Ordre"}),e.jsx("input",{type:"number",min:"0",value:r.ordre,onChange:s=>a({...r,ordre:s.target.value}),className:"mt-1 w-full rounded-lg border border-gray-200 px-3 py-2 focus:border-[#03800a] focus:outline-none focus:ring-2 focus:ring-green-200"})]}),e.jsxs("div",{className:"flex items-center gap-3 pt-6",children:[e.jsx("input",{type:"checkbox",id:"actif",checked:r.actif,onChange:s=>a({...r,actif:s.target.checked}),className:"h-4 w-4 rounded border-gray-300 text-[#03800a] focus:ring-[#03800a]"}),e.jsx("label",{htmlFor:"actif",className:"text-sm font-medium text-gray-700",children:"Actif (visible sur le site)"})]})]}),e.jsxs("div",{className:"flex items-center justify-end gap-3 border-t pt-4",children:[e.jsx("button",{type:"button",onClick:()=>{m(!1),g()},className:"rounded-lg px-4 py-2 text-sm font-semibold text-gray-600 hover:bg-gray-100",children:"Annuler"}),e.jsx("button",{type:"submit",disabled:C,className:"rounded-lg bg-[#03800a] px-5 py-2 text-sm font-semibold text-white shadow-sm hover:bg-green-700 disabled:opacity-60",children:C?"Enregistrement...":"Enregistrer"})]})]})]})}),e.jsx(V,{open:j.open,onClose:()=>y({open:!1,id:null}),onConfirm:L,title:"Supprimer cette direction ?",message:"Cette action est irréversible. La direction sera définitivement supprimée.",confirmText:"Supprimer",type:"danger",loading:A})]})};Y.layout=u=>e.jsx(U,{children:u});export{Y as default};
