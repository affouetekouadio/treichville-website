import{u as ie,r as o,j as e,H as le}from"./app-zp8a_1Kz.js";import{A as ce}from"./app-layout-CePoWWuH.js";import{u as de,b as F,X as W}from"./NotificationContainer-gxxL-dmH.js";import{T as me,C as pe}from"./ConfirmDialog-Br3_tiJq.js";import{I as ue}from"./ImagePreviewModal-b_Jp4KPZ.js";import{L as xe}from"./ListingToolbar-BSqKS32_.js";import{l as p,a as fe,L as ge}from"./listing-CyK14IAB.js";import{u as he}from"./use-listing-search-E-iLxo6C.js";import{P as be}from"./plus-CUhRo2XF.js";import{G as je}from"./grip-vertical-CbAga6LN.js";import{E as ye}from"./eye-BVJGR6gk.js";import{T as ve}from"./trees-NIDW7sVC.js";import{W as Ne}from"./waves-DD5prBl5.js";import{S as we}from"./square-pen-CR4kVuYF.js";import{U as Se}from"./upload-ZmEkxWvd.js";/* empty css            */import"./utils-BXHwvztH.js";import"./button-CiEhR-Zp.js";import"./index-BJyFvceU.js";import"./index-Cn9ca9qa.js";import"./proxy-CiNOm1L4.js";import"./index-w_94M6Cx.js";import"./index-CMWG4mbA.js";import"./book-open-BMmTLku0.js";import"./megaphone-9k5Y78Jh.js";import"./landmark-CZwsELM-.js";import"./tag-CRsMMEZF.js";import"./users-CfERKPYF.js";import"./chevron-right-D4ZEOqXu.js";import"./download-BEF9xMVZ.js";const qe=({lieux:u=[],listing:y})=>{const{addNotification:x}=de(),{url:z}=ie(),l=z.split("?")[0],[w,A]=o.useState(u),[K,h]=o.useState(!1),[O,R]=o.useState(!1),[f,M]=o.useState(null),[S,q]=o.useState({open:!1,id:null}),[V,X]=o.useState(!1),[C,G]=o.useState({open:!1,url:"",title:""}),[U,E]=o.useState(null),[r,i]=o.useState({type:"Parc",nom:"",description:"",horaires:"",acces:"Gratuit",equipements:[""],actif:!0,is_flash_info:!1}),[H,P]=o.useState(null),[v,k]=o.useState(null),[_,J]=o.useState(y?.filters.search??""),D=y?.filters.sort??"ordre",L=y?.filters.direction??"asc",g=y?.pagination??{page:1,per_page:15,total:u.length,last_page:1},c=o.useMemo(()=>({search:_,sort:D,direction:L,per_page:g.per_page}),[g.per_page,_,L,D]);he(l,c),o.useEffect(()=>{A(u)},[u]);const N=()=>{i({type:"Parc",nom:"",description:"",horaires:"",acces:"Gratuit",equipements:[""],actif:!0,is_flash_info:!1}),P(null),E(null),M(null)},B=s=>{i({type:s.type,nom:s.nom,description:s.description,horaires:s.horaires||"",acces:s.acces,equipements:s.equipements&&s.equipements.length>0?s.equipements:[""],actif:s.actif,is_flash_info:s.is_flash_info||!1}),P(null),E(s.image_url),M(s.id),h(!0)},Q=async s=>{s.preventDefault(),R(!0);try{const t=new FormData;t.append("type",r.type),t.append("nom",r.nom),t.append("description",r.description),t.append("horaires",r.horaires||""),t.append("acces",r.acces),t.append("actif",r.actif?"1":"0"),t.append("is_flash_info",r.is_flash_info?"1":"0"),r.equipements.filter(d=>d.trim()!=="").forEach((d,a)=>{t.append(`equipements[${a}]`,d)}),H&&t.append("image",H),f&&t.append("_method","PUT");const m=document.querySelector('meta[name="csrf-token"]')?.content??"",T=f?`/admin/api/lieux/${f}`:"/admin/api/lieux",b=await fetch(T,{method:"POST",headers:{"X-CSRF-TOKEN":m,"X-Requested-With":"XMLHttpRequest"},body:t});if(!b.ok){const d=await b.json();throw new Error(d.message||"Erreur de sauvegarde")}const I=await b.json();x("success",I.message||(f?"Lieu modifié":"Lieu créé")),h(!1),N(),p(l,{...c,page:1})}catch(t){console.error(t),x("error",t instanceof Error?t.message:"Impossible de sauvegarder le lieu")}finally{R(!1)}},Y=s=>{q({open:!0,id:s})},Z=async()=>{if(S.id){X(!0);try{const s=document.querySelector('meta[name="csrf-token"]')?.content??"",t=await fetch(`/admin/api/lieux/${S.id}`,{method:"DELETE",headers:{"X-CSRF-TOKEN":s,"X-Requested-With":"XMLHttpRequest"}});if(!t.ok){const m=await t.json();throw new Error(m.message||"Erreur de suppression")}const n=await t.json();x("success",n.message||"Lieu supprimé"),q({open:!1,id:null}),p(l,c)}catch(s){console.error(s),x("error",s instanceof Error?s.message:"Impossible de supprimer le lieu")}finally{X(!1)}}},ee=s=>{const t=s.target.files?.[0];t&&(P(t),E(URL.createObjectURL(t)))},se=()=>{i({...r,equipements:[...r.equipements,""]})},te=s=>{const t=r.equipements.filter((n,m)=>m!==s);i({...r,equipements:t.length>0?t:[""]})},re=(s,t)=>{const n=[...r.equipements];n[s]=t,i({...r,equipements:n})},ae=(s,t)=>{k(t),s.dataTransfer.effectAllowed="move"},ne=s=>{s.preventDefault(),s.dataTransfer.dropEffect="move"},oe=async(s,t)=>{if(s.preventDefault(),!v||v===t){k(null);return}const n=[...w],m=n.findIndex(a=>a.id===v),T=n.findIndex(a=>a.id===t),[b]=n.splice(m,1);n.splice(T,0,b);const I=n.map(a=>a.ordre).sort((a,j)=>a-j),d=n.map((a,j)=>({...a,ordre:I[j]??a.ordre}));A(d),k(null);try{const a=document.querySelector('meta[name="csrf-token"]')?.content??"",j=d.map($=>({id:$.id,ordre:$.ordre}));if(!(await fetch("/admin/api/lieux/update-order",{method:"POST",headers:{"X-CSRF-TOKEN":a,"X-Requested-With":"XMLHttpRequest","Content-Type":"application/json"},body:JSON.stringify({orders:j})})).ok)throw new Error("Erreur lors de la mise à jour de l'ordre");x("success","Ordre mis à jour")}catch(a){console.error(a),x("error","Erreur lors de la mise à jour de l'ordre"),p(l,c)}};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-col gap-6 p-4",children:[e.jsx(le,{title:"Endroit à découvrir"}),e.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex h-10 w-10 items-center justify-center rounded-lg bg-blue-100",children:e.jsx(F,{className:"h-5 w-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Endroit à découvrir"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Gestion des parcs et piscines (ordre modifiable par glisser-déposer)"})]})]}),e.jsxs("button",{onClick:()=>{N(),h(!0)},className:"inline-flex items-center gap-2 rounded-lg bg-[#f8812f] px-4 py-2 text-sm font-semibold text-white shadow-sm hover:bg-orange-600 transition-colors",children:[e.jsx(be,{className:"h-4 w-4"}),"Nouveau lieu"]})]}),e.jsx(xe,{search:_,perPage:g.per_page,sort:{value:D,direction:L},sortOptions:[{value:"ordre",label:"Ordre"},{value:"nom",label:"Nom"},{value:"type",label:"Type"},{value:"created_at",label:"Créé le"}],onSearchChange:J,onSearchSubmit:()=>p(l,{...c,page:1}),onPerPageChange:s=>p(l,{...c,per_page:s,page:1}),onExport:s=>fe(l,c,s),onSortChange:(s,t)=>p(l,{...c,sort:s,direction:t})}),e.jsx("div",{className:"rounded-xl border border-gray-200 bg-white shadow-sm",children:w.length===0?e.jsxs("div",{className:"p-12 text-center",children:[e.jsx(F,{className:"mx-auto h-12 w-12 text-[#03800a]"}),e.jsx("h3",{className:"mt-4 text-lg font-semibold text-gray-900",children:"Aucun lieu"}),e.jsx("p",{className:"mt-2 text-sm text-gray-500",children:"Commencez par ajouter un parc ou une piscine"})]}):e.jsx("div",{className:"divide-y divide-gray-200",children:w.map(s=>e.jsxs("div",{draggable:!0,onDragStart:t=>ae(t,s.id),onDragOver:ne,onDrop:t=>oe(t,s.id),className:`flex items-center gap-4 p-4 transition-colors ${v===s.id?"opacity-50":"hover:bg-gray-50"} ${s.actif?"":"bg-gray-50"}`,children:[e.jsx("div",{className:"cursor-move text-gray-400 hover:text-[#03800a]",children:e.jsx(je,{className:"h-5 w-5"})}),e.jsx("div",{className:"flex-shrink-0",children:s.image_url?e.jsxs("button",{onClick:()=>G({open:!0,url:s.image_url,title:s.nom}),className:"relative group",children:[e.jsx("img",{src:s.image_url,alt:s.nom,className:"h-16 w-16 rounded-lg object-cover ring-2 ring-gray-200 group-hover:ring-[#f8812f] transition-all"}),e.jsx("div",{className:"absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 transition-opacity rounded-lg flex items-center justify-center",children:e.jsx(ye,{className:"h-5 w-5 text-white"})})]}):e.jsx("div",{className:"h-16 w-16 rounded-lg bg-gray-100 flex items-center justify-center",children:e.jsx(F,{className:"h-8 w-8 text-gray-400"})})}),e.jsx("div",{className:"flex-shrink-0",children:s.type==="Parc"?e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full bg-green-100 px-3 py-1 text-xs font-medium text-green-700",children:[e.jsx(ve,{className:"h-3 w-3"}),"Parc"]}):e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full bg-blue-100 px-3 py-1 text-xs font-medium text-blue-700",children:[e.jsx(Ne,{className:"h-3 w-3"}),"Piscine"]})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"text-base font-semibold text-gray-900",children:s.nom}),!s.actif&&e.jsx("span",{className:"inline-flex items-center rounded-full bg-gray-100 px-2 py-0.5 text-xs font-medium text-gray-600",children:"Inactif"}),e.jsx("span",{className:`inline-flex items-center rounded-full px-2 py-0.5 text-xs font-medium ${s.acces==="Gratuit"?"bg-green-100 text-green-700":"bg-orange-100 text-orange-700"}`,children:s.acces})]}),e.jsx("p",{className:"text-sm text-gray-600 line-clamp-1",children:s.description})]}),e.jsx("div",{className:"text-center",children:e.jsx("span",{className:"inline-flex h-8 w-8 items-center justify-center rounded-full bg-blue-100 text-sm font-semibold text-blue-600",children:s.ordre})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>B(s),className:"rounded p-2 text-blue-600 hover:bg-blue-50 transition-colors",title:"Éditer",children:e.jsx(we,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>Y(s.id),className:"rounded p-2 text-red-600 hover:bg-red-50 transition-colors",title:"Supprimer",children:e.jsx(me,{className:"h-4 w-4"})})]})]},s.id))})}),e.jsx(ge,{page:g.page,lastPage:g.last_page,total:g.total,onPageChange:s=>p(l,{...c,page:s})})]}),K&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-start justify-center bg-black/40 px-4 overflow-y-auto py-6",children:e.jsxs("div",{className:"w-full max-w-2xl rounded-2xl bg-white shadow-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between border-b px-6 py-4",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-xs uppercase tracking-wide text-gray-500",children:[f?"Modifier":"Nouveau"," lieu"]}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:f?"Modifier le lieu":"Ajouter un lieu"})]}),e.jsx("button",{onClick:()=>{h(!1),N()},className:"rounded-full p-2 text-gray-500 hover:bg-gray-100",children:e.jsx(W,{className:"h-5 w-5"})})]}),e.jsxs("form",{className:"space-y-4 px-6 py-5",onSubmit:Q,children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Type *"}),e.jsxs("select",{required:!0,value:r.type,onChange:s=>i({...r,type:s.target.value}),className:"mt-1 w-full rounded-lg border border-gray-200 px-3 py-2 focus:border-[#f8812f] focus:outline-none focus:ring-2 focus:ring-orange-200",children:[e.jsx("option",{value:"Parc",children:"Parc"}),e.jsx("option",{value:"Piscine",children:"Piscine"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Accès *"}),e.jsxs("select",{required:!0,value:r.acces,onChange:s=>i({...r,acces:s.target.value}),className:"mt-1 w-full rounded-lg border border-gray-200 px-3 py-2 focus:border-[#f8812f] focus:outline-none focus:ring-2 focus:ring-orange-200",children:[e.jsx("option",{value:"Gratuit",children:"Gratuit"}),e.jsx("option",{value:"Payant",children:"Payant"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Nom *"}),e.jsx("input",{required:!0,value:r.nom,onChange:s=>i({...r,nom:s.target.value}),className:"mt-1 w-full rounded-lg border border-gray-200 px-3 py-2 focus:border-[#f8812f] focus:outline-none focus:ring-2 focus:ring-orange-200",placeholder:"Ex: Jardin Public de Treichville"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Description *"}),e.jsx("textarea",{required:!0,rows:3,value:r.description,onChange:s=>i({...r,description:s.target.value}),className:"mt-1 w-full rounded-lg border border-gray-200 px-3 py-2 focus:border-[#f8812f] focus:outline-none focus:ring-2 focus:ring-orange-200",placeholder:"Décrivez le lieu..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Horaires (optionnel)"}),e.jsx("input",{value:r.horaires,onChange:s=>i({...r,horaires:s.target.value}),className:"mt-1 w-full rounded-lg border border-gray-200 px-3 py-2 focus:border-[#f8812f] focus:outline-none focus:ring-2 focus:ring-orange-200",placeholder:"Ex: 6h00 - 18h00"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 mb-2 block",children:"Équipements (optionnel)"}),r.equipements.map((s,t)=>e.jsxs("div",{className:"flex gap-2 mb-2",children:[e.jsx("input",{value:s,onChange:n=>re(t,n.target.value),className:"flex-1 rounded-lg border border-gray-200 px-3 py-2 focus:border-[#f8812f] focus:outline-none focus:ring-2 focus:ring-orange-200",placeholder:"Ex: Aires de jeux"}),r.equipements.length>1&&e.jsx("button",{type:"button",onClick:()=>te(t),className:"px-3 py-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors",children:e.jsx(W,{className:"h-4 w-4"})})]},t)),e.jsx("button",{type:"button",onClick:se,className:"mt-1 text-sm text-[#03800a] hover:text-green-700 font-medium",children:"+ Ajouter un équipement"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Photo"}),U&&e.jsx("div",{className:"mt-2 mb-3",children:e.jsx("img",{src:U,alt:"Aperçu",className:"h-32 w-full rounded-lg object-cover border-2 border-orange-200"})}),e.jsxs("label",{className:"mt-2 flex cursor-pointer items-center gap-2 rounded-lg border-2 border-dashed border-gray-300 px-4 py-3 hover:border-[#f8812f] hover:bg-orange-50 transition-colors",children:[e.jsx(Se,{className:"h-5 w-5 text-gray-500"}),e.jsx("span",{className:"text-sm text-gray-600",children:"Choisir une photo"}),e.jsx("input",{type:"file",accept:"image/*",onChange:ee,className:"hidden"})]}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Format image, max 10 Mo"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",id:"actif",checked:r.actif,onChange:s=>i({...r,actif:s.target.checked}),className:"h-4 w-4 rounded border-gray-300 text-[#03800a] focus:ring-[#03800a]"}),e.jsx("label",{htmlFor:"actif",className:"text-sm font-medium text-gray-700",children:"Actif (visible sur le site)"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",id:"is_flash_info",checked:r.is_flash_info,onChange:s=>i({...r,is_flash_info:s.target.checked}),className:"h-4 w-4 rounded border-gray-300 text-[#f8812f] focus:ring-[#f8812f]"}),e.jsx("label",{htmlFor:"is_flash_info",className:"text-sm font-medium text-gray-700",children:"Afficher en flash info"})]}),e.jsx("p",{className:"text-xs text-gray-500 -mt-2 ml-7",children:"Afficher ce lieu dans le bandeau flash info de la page d'accueil"}),e.jsxs("div",{className:"flex items-center justify-end gap-3 border-t pt-4",children:[e.jsx("button",{type:"button",onClick:()=>{h(!1),N()},className:"rounded-lg px-4 py-2 text-sm font-semibold text-gray-600 hover:bg-gray-100",children:"Annuler"}),e.jsx("button",{type:"submit",disabled:O,className:"rounded-lg bg-[#03800a] px-5 py-2 text-sm font-semibold text-white shadow-sm hover:bg-green-700 disabled:opacity-60",children:O?"Enregistrement...":"Enregistrer"})]})]})]})}),e.jsx(pe,{open:S.open,onClose:()=>q({open:!1,id:null}),onConfirm:Z,title:"Supprimer ce lieu ?",message:"Cette action est irréversible. Le lieu sera définitivement supprimé.",confirmText:"Supprimer",type:"danger",loading:V}),e.jsx(ue,{open:C.open,onClose:()=>G({open:!1,url:"",title:""}),imageUrl:C.url,title:C.title})]})};qe.layout=u=>e.jsx(ce,{children:u});export{qe as default};
