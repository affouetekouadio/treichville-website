import{r as l,j as e,H as F}from"./app-CxsUZNRk.js";import{A as b,S as D}from"./app-layout-C-eYnInK.js";import{u as L,X as T}from"./NotificationContainer-ClRgWa5q.js";import{I as J}from"./ImagePreviewModal-Dqm8FkXl.js";import{c as V}from"./proxy-nIHRNzfy.js";import{U as W}from"./upload-CrpeD7Qk.js";/* empty css            */import"./utils-CWpWFhVN.js";import"./button-B5cEFkY0.js";import"./index-BViRWBSq.js";import"./index-DzWG0LfO.js";import"./index-w_94M6Cx.js";import"./index-CMWG4mbA.js";import"./book-open-DZqK2S_K.js";import"./megaphone-BMpck1R8.js";import"./tag-BnB9tJi7.js";import"./users-B-O3NJjx.js";import"./chevron-right-CHSGYyhq.js";import"./download-CmvFp7GU.js";const X=[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]],$=V("Save",X),q=()=>{const{addNotification:c}=L(),[p,O]=l.useState({}),[H,f]=l.useState(!0),[j,y]=l.useState(!1),[m,I]=l.useState("general"),[d,u]=l.useState({}),[v,N]=l.useState({}),w=l.useRef(!1),x=l.useRef(!1),[h,S]=l.useState({open:!1,url:"",title:""});l.useEffect(()=>{C()},[]);const C=async()=>{if(!x.current){x.current=!0;try{const r=await fetch("/admin/api/settings"),s=r.ok?await r.json():null;if(!r.ok||!s)throw new Error("Erreur lors de la récupération des paramètres");O(s);const a={};Object.entries(s).forEach(([t,n])=>{Object.entries(n).forEach(([o,i])=>{a[o]=i.value||""})}),u(a),f(!1)}catch(r){console.error("Erreur lors de la récupération des paramètres:",r),w.current||(c("error","Erreur lors du chargement des paramètres"),w.current=!0),f(!1)}finally{x.current=!1}}},E=(r,s)=>{if(s){u(t=>({...t,[r]:s}));const a=URL.createObjectURL(s);N(t=>({...t,[r]:a}))}else u(a=>({...a,[r]:""})),N(a=>{const t={...a};return delete t[r],t})},k=(r,s)=>{u(a=>({...a,[r]:s}))},g=(r,s,a)=>{const t=d.opening_hours?JSON.parse(d.opening_hours):{},n={...t,[r]:{...t[r]||{open:"08:00",close:"17:00",closed:!1},[s]:a}};u(o=>({...o,opening_hours:JSON.stringify(n)}))},M=async r=>{r.preventDefault(),y(!0);try{const s=new FormData;Object.entries(d).forEach(([o,i])=>{i instanceof File?s.append(o,i):i!=null&&s.append(o,String(i))});const a=document.querySelector('meta[name="csrf-token"]')?.getAttribute("content"),t=await fetch("/admin/api/settings/batch",{method:"POST",body:s,headers:{"X-CSRF-TOKEN":a||""}}),n=await t.json();if(t.ok)c("success",n.message||"Paramètres mis à jour avec succès"),await C();else throw new Error(n.message||"Erreur lors de la mise à jour")}catch(s){console.error("Erreur:",s),c("error",s.message||"Erreur lors de la mise à jour des paramètres")}finally{y(!1)}},P=r=>{if(v[r])return v[r];const s=d[r];return s?typeof s=="string"&&(s.startsWith("http://")||s.startsWith("https://"))?s:`/storage/${s}`:null},U=[{id:"general",label:"Général",group:"general"},{id:"appearance",label:"Apparence",group:"appearance"},{id:"contact",label:"Contact",group:"contact"},{id:"social",label:"Réseaux Sociaux",group:"social"}],R=[{id:"monday",label:"Lundi"},{id:"tuesday",label:"Mardi"},{id:"wednesday",label:"Mercredi"},{id:"thursday",label:"Jeudi"},{id:"friday",label:"Vendredi"},{id:"saturday",label:"Samedi"},{id:"sunday",label:"Dimanche"}],A=r=>{const s=r.key,a=d[s]||"";if(s==="opening_hours"){const t=a?JSON.parse(a):{};return e.jsxs("div",{className:"space-y-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Heures d'ouverture"}),R.map(n=>{const o=t[n.id]||{open:"08:00",close:"17:00",closed:!1};return e.jsxs("div",{className:"flex items-center gap-4 p-3 bg-gray-50 rounded-lg",children:[e.jsx("div",{className:"w-24 font-medium text-sm",children:n.label}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:!o.closed,onChange:i=>g(n.id,"closed",!i.target.checked),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),e.jsx("span",{className:"text-sm text-gray-600",children:"Ouvert"})]}),!o.closed&&e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"time",value:o.open,onChange:i=>g(n.id,"open",i.target.value),className:"px-3 py-1.5 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 text-sm"}),e.jsx("span",{className:"text-gray-500",children:"à"}),e.jsx("input",{type:"time",value:o.close,onChange:i=>g(n.id,"close",i.target.value),className:"px-3 py-1.5 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 text-sm"})]}),o.closed&&e.jsx("span",{className:"text-sm text-gray-500 italic",children:"Fermé"})]},n.id)})]})}if(r.type==="image"){const t=P(s);return e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:r.description||s}),t&&e.jsxs("div",{className:"relative inline-block",children:[e.jsx("img",{src:t,alt:r.description||s,className:"h-24 w-24 object-cover rounded-lg border border-gray-300 cursor-pointer hover:ring-2 hover:ring-blue-500 transition-all",onClick:()=>S({open:!0,url:t,title:r.description||s})}),e.jsx("button",{type:"button",onClick:()=>E(s,null),className:"absolute -top-2 -right-2 p-1 bg-red-500 text-white rounded-full hover:bg-red-600 transition-colors",title:"Supprimer l'image",children:e.jsx(T,{className:"h-3 w-3"})})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("label",{className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg cursor-pointer hover:bg-blue-700 transition-colors",children:[e.jsx(W,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm",children:t?"Changer l'image":"Choisir une image"}),e.jsx("input",{type:"file",accept:"image/*",onChange:n=>E(s,n.target.files?.[0]||null),className:"hidden"})]})}),r.description&&e.jsx("p",{className:"text-xs text-gray-500",children:r.description})]})}return e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:r.description||s}),r.key.includes("description")||r.key.includes("address")?e.jsx("textarea",{value:a,onChange:t=>k(s,t.target.value),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:r.description||""}):e.jsx("input",{type:"text",value:a,onChange:t=>k(s,t.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:r.description||""})]})};return H?e.jsxs(b,{children:[e.jsx(F,{title:"Paramètres"}),e.jsx("div",{className:"p-6",children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"text-gray-500",children:"Chargement des paramètres..."})})})]}):e.jsxs(b,{children:[e.jsx(F,{title:"Paramètres"}),e.jsxs("div",{className:"p-6",children:[e.jsx("div",{className:"mb-6 flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex h-10 w-10 items-center justify-center rounded-lg bg-blue-100",children:e.jsx(D,{className:"h-5 w-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Paramètres"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Configuration générale du site"})]})]})}),e.jsxs("form",{onSubmit:M,children:[e.jsx("div",{className:"mb-6 border-b border-gray-200",children:e.jsx("nav",{className:"-mb-px flex gap-4",children:U.map(r=>e.jsx("button",{type:"button",onClick:()=>I(r.id),className:`px-4 py-3 text-sm font-medium border-b-2 transition-colors ${m===r.id?"border-blue-600 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:r.label},r.id))})}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"space-y-6",children:[p[m]&&Object.entries(p[m]).map(([r,s])=>e.jsx("div",{children:A(s)},r)),!p[m]&&e.jsx("div",{className:"text-center py-8 text-gray-500",children:"Aucun paramètre disponible pour cette section"})]}),e.jsx("div",{className:"mt-8 flex justify-end",children:e.jsx("button",{type:"submit",disabled:j,className:"flex items-center gap-2 px-6 py-2.5 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:bg-blue-400 disabled:cursor-not-allowed transition-colors",children:j?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"h-4 w-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),e.jsx("span",{children:"Enregistrement..."})]}):e.jsxs(e.Fragment,{children:[e.jsx($,{className:"h-4 w-4"}),e.jsx("span",{children:"Enregistrer les modifications"})]})})})]})]})]}),e.jsx(J,{open:h.open,onClose:()=>S({open:!1,url:"",title:""}),imageUrl:h.url,title:h.title})]})};q.layout=c=>e.jsx(b,{children:c});export{q as default};
