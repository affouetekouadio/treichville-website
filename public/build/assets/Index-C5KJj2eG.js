import{u as K,r,j as e,H as U,L as V}from"./app-BHzqiJ_z.js";import{L as W,l as d,a as z,b as G}from"./listing-DuJ96Ipm.js";import{A as J}from"./app-layout-p_JMC4Gz.js";import{R as Q}from"./RichTextEditor-CO0dy1dU.js";import{u as Y}from"./use-listing-search-sL1Q9-BQ.js";import{u as Z,X as ee}from"./NotificationContainer-CtIDklMV.js";import{T as te,C as se}from"./ConfirmDialog-pKaKMbcM.js";import{I as ae}from"./ImagePreviewModal-BqYWZ81o.js";import{P as re}from"./plus-DQ3YaAMn.js";import{I as le}from"./image-DV1M7n5L.js";import{E as ie}from"./eye-C9wR_PQl.js";import{S as oe}from"./square-pen-jRmxV4gH.js";/* empty css            */import"./utils-B6rCUee9.js";import"./button-DI_2iZ4T.js";import"./index-BHQWyDIh.js";import"./index-LXxb8B22.js";import"./proxy-xxjnpx_T.js";import"./index-w_94M6Cx.js";import"./index-CMWG4mbA.js";import"./book-open-BKJjOrba.js";import"./megaphone-BvfTVna8.js";import"./tag-UAamrcmp.js";import"./users-BQ-bCsJ7.js";import"./chevron-right-BaDd2qxa.js";import"./download-DrvjlFl9.js";const ne=({actualites:u=[],categories:A=[],listing:m})=>{const{addNotification:x}=Z(),{url:I}=K(),l=I.split("?")[0],[h,F]=r.useState(m?.filters.search??""),f=m?.filters.sort??"created_at",b=m?.filters.direction??"desc",n=m?.pagination??{page:1,per_page:15,total:u.length,last_page:1},i=r.useMemo(()=>({search:h,sort:f,direction:b,per_page:n.per_page}),[n.per_page,h,b,f]);Y(l,i);const[R,p]=r.useState(!1),[S,E]=r.useState(!1),[g,_]=r.useState(null),[j,y]=r.useState({open:!1,id:null}),[q,k]=r.useState(!1),[v,P]=r.useState({open:!1,url:"",title:""}),[s,o]=r.useState({titre:"",categorie:"",category_id:"",status:"published",published_at:"",description:"",contenu:""}),[D,L]=r.useState(null),T=()=>{o({titre:"",categorie:"",category_id:"",status:"published",published_at:"",description:"",contenu:""}),L(null),_(null)},M=async t=>{t.preventDefault(),E(!0);try{const a=document.querySelector('meta[name="csrf-token"]')?.content??"",c=new FormData;Object.entries(s).forEach(([C,B])=>c.append(C,B??"")),D&&c.append("image",D),g&&c.append("_method","PUT");const N=g?`/admin/api/actualites/${g}`:"/admin/api/actualites",w=await fetch(N,{method:"POST",headers:{"X-CSRF-TOKEN":a,"X-Requested-With":"XMLHttpRequest"},body:c});if(!w.ok){const C=await w.json();throw new Error(C.message||"Erreur de sauvegarde")}const $=await w.json();x("success",$.message||(g?"Actualité modifiée":"Actualité créée")),p(!1),T(),d(l,{...i,page:1})}catch(a){console.error(a),x("error",a instanceof Error?a.message:"Impossible de sauvegarder l'actualité")}finally{E(!1)}},X=t=>{o({titre:t.titre,categorie:t.categorie||"",category_id:String(t.category_id||""),status:t.status||"draft",published_at:t.published_at?t.published_at.split("T")[0]:"",description:t.description||"",contenu:t.contenu||""}),_(t.id),p(!0)},O=t=>{y({open:!0,id:t})},H=async()=>{if(j.id){k(!0);try{const t=document.querySelector('meta[name="csrf-token"]')?.content??"",a=await fetch(`/admin/api/actualites/${j.id}`,{method:"DELETE",headers:{"X-CSRF-TOKEN":t,"X-Requested-With":"XMLHttpRequest"}});if(!a.ok){const N=await a.json();throw new Error(N.message||"Erreur de suppression")}const c=await a.json();x("success",c.message||"Actualité supprimée"),y({open:!1,id:null}),d(l,i)}catch(t){console.error(t),x("error",t instanceof Error?t.message:"Impossible de supprimer l'actualité")}finally{k(!1)}}};return e.jsxs("div",{className:"flex flex-col gap-6 p-4",children:[e.jsx(U,{title:"Actualités"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm uppercase tracking-wide text-gray-500",children:"Contenu"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Actualités"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Liste des articles déjà saisis. Ajouter/éditer à connecter ensuite."})]}),e.jsxs("button",{onClick:()=>p(!0),className:"inline-flex items-center gap-2 rounded-lg bg-[#03800a] px-4 py-2 text-sm font-semibold text-white shadow-sm hover:bg-[#166e7b]",children:[e.jsx(re,{className:"h-4 w-4"}),"Nouvelle actualité"]})]}),e.jsx(W,{search:h,perPage:n.per_page,sort:{value:f,direction:b},sortOptions:[{value:"created_at",label:"Date creation"},{value:"published_at",label:"Date publication"},{value:"titre",label:"Titre"},{value:"status",label:"Statut"}],onSearchChange:F,onSearchSubmit:()=>d(l,{...i,page:1}),onPerPageChange:t=>d(l,{...i,per_page:t,page:1}),onExport:t=>z(l,i,t),onSortChange:(t,a)=>d(l,{...i,sort:t,direction:a})}),e.jsx("div",{className:"rounded-xl border border-gray-200 bg-white p-0 shadow-sm",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-50 text-left text-xs uppercase text-gray-500",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3",children:"Image"}),e.jsx("th",{className:"px-4 py-3",children:"Titre"}),e.jsx("th",{className:"px-4 py-3",children:"Catégorie"}),e.jsx("th",{className:"px-4 py-3",children:"Statut"}),e.jsx("th",{className:"px-4 py-3",children:"Publié le"}),e.jsx("th",{className:"px-4 py-3",children:"Actions"})]})}),e.jsx("tbody",{children:u.length?u.map(t=>e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"px-4 py-3",children:t.image_url?e.jsxs("button",{onClick:()=>P({open:!0,url:t.image_url,title:t.titre}),className:"relative group cursor-pointer",title:"Cliquer pour agrandir",children:[e.jsx("img",{src:t.image_url,alt:t.titre,className:"h-12 w-20 rounded object-cover bg-gray-100 transition-all group-hover:ring-2 group-hover:ring-blue-500 group-hover:ring-offset-2"}),e.jsx("div",{className:"absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 transition-opacity rounded flex items-center justify-center",children:e.jsx("svg",{className:"h-5 w-5 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0zM10 7v3m0 0v3m0-3h3m-3 0H7"})})})]}):e.jsx("div",{className:"flex h-12 w-20 items-center justify-center rounded bg-gray-100",children:e.jsx(le,{className:"h-6 w-6 text-gray-400"})})}),e.jsx("td",{className:"px-4 py-3 font-medium text-gray-900",children:t.titre}),e.jsx("td",{className:"px-4 py-3 text-gray-700",children:t.category?.name||t.categorie||"—"}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:`inline-flex rounded-full px-2 py-1 text-xs font-semibold ${t.status==="published"?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:t.status==="published"?"Publié":"Brouillon"})}),e.jsx("td",{className:"px-4 py-3 text-gray-700",children:t.published_at?new Date(t.published_at).toLocaleDateString():"—"}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(V,{href:`/admin/actualites/${t.id}`,className:"rounded p-1 text-gray-600 hover:bg-gray-100",title:"Voir le détail",children:e.jsx(ie,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>X(t),className:"rounded p-1 text-blue-600 hover:bg-blue-50",title:"Éditer",children:e.jsx(oe,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>O(t.id),className:"rounded p-1 text-red-600 hover:bg-red-50",title:"Supprimer",children:e.jsx(te,{className:"h-4 w-4"})})]})})]},t.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"px-4 py-6 text-center text-gray-500",children:"Aucune actualité pour le moment."})})})]})})}),e.jsx(G,{page:n.page,lastPage:n.last_page,total:n.total,onPageChange:t=>d(l,{...i,page:t})}),R&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40 px-4 py-6 overflow-y-auto",children:e.jsxs("div",{className:"w-full max-w-2xl rounded-2xl bg-white shadow-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between border-b px-6 py-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-wide text-gray-500",children:"Nouvelle actualité"}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Créer un article"})]}),e.jsx("button",{className:"rounded-full p-2 text-gray-500 hover:bg-gray-100",onClick:()=>{p(!1),T()},children:e.jsx(ee,{className:"h-5 w-5"})})]}),e.jsxs("form",{className:"space-y-4 px-6 py-5",onSubmit:M,children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Titre *"}),e.jsx("input",{required:!0,value:s.titre,onChange:t=>o({...s,titre:t.target.value}),className:"mt-1 w-full rounded-lg border border-gray-200 px-3 py-2 focus:border-[#03800a] focus:outline-none focus:ring-2 focus:ring-[#03800a]/20",placeholder:"Titre de l’article"})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Catégorie"}),e.jsxs("select",{value:s.category_id,onChange:t=>o({...s,category_id:t.target.value,categorie:""}),className:"mt-1 w-full rounded-lg border border-gray-200 px-3 py-2 focus:border-[#03800a] focus:outline-none focus:ring-2 focus:ring-[#03800a]/20",children:[e.jsx("option",{value:"",children:"Sélectionner"}),A.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Catégories limitées au type Actualité."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Publié le"}),e.jsx("input",{type:"date",value:s.published_at,onChange:t=>o({...s,published_at:t.target.value}),className:"mt-1 w-full rounded-lg border border-gray-200 px-3 py-2 focus:border-[#03800a] focus:outline-none focus:ring-2 focus:ring-[#03800a]/20"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Statut"}),e.jsxs("select",{value:s.status,onChange:t=>o({...s,status:t.target.value}),className:"mt-1 w-full rounded-lg border border-gray-200 px-3 py-2 focus:border-[#03800a] focus:outline-none focus:ring-2 focus:ring-[#03800a]/20",children:[e.jsx("option",{value:"published",children:"Publié"}),e.jsx("option",{value:"draft",children:"Brouillon"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Description courte"}),e.jsx("textarea",{value:s.description,onChange:t=>o({...s,description:t.target.value}),rows:3,className:"mt-1 w-full rounded-lg border border-gray-200 px-3 py-2 focus:border-[#03800a] focus:outline-none focus:ring-2 focus:ring-[#03800a]/20",placeholder:"Résumé affiché sur la carte"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Contenu (CKEditor)"}),e.jsx(Q,{value:s.contenu,onChange:t=>o({...s,contenu:t}),placeholder:"Saisir l’article complet"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Image principale"}),e.jsx("input",{type:"file",accept:"image/*",onChange:t=>L(t.target.files?.[0]??null),className:"mt-1 w-full rounded-lg border border-gray-200 px-3 py-2 focus:border-[#03800a] focus:outline-none focus:ring-2 focus:ring-[#03800a]/20"}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Formats image, max 4 Mo."})]}),e.jsxs("div",{className:"flex items-center justify-end gap-3 border-t pt-4",children:[e.jsx("button",{type:"button",className:"rounded-lg px-4 py-2 text-sm font-semibold text-gray-600 hover:bg-gray-100",onClick:()=>p(!1),children:"Annuler"}),e.jsx("button",{type:"submit",disabled:S,className:"rounded-lg bg-[#03800a] px-5 py-2 text-sm font-semibold text-white shadow-sm hover:bg-[#166e7b] disabled:opacity-60",children:S?"Enregistrement...":"Enregistrer"})]})]})]})}),e.jsx(se,{open:j.open,onClose:()=>y({open:!1,id:null}),onConfirm:H,title:"Supprimer cette actualité ?",message:"Cette action est irréversible. L'actualité sera définitivement supprimée.",confirmText:"Supprimer",type:"danger",loading:q}),e.jsx(ae,{open:v.open,onClose:()=>P({open:!1,url:"",title:""}),imageUrl:v.url,title:v.title})]})};ne.layout=u=>e.jsx(J,{children:u});export{ne as default};
