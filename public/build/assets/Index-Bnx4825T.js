import{r as a,j as e,H as X}from"./app-BK6a77m0.js";import{A as Z}from"./app-layout-BSUXv4ox.js";import{u as _,X as ee}from"./NotificationContainer-BbzJvoSV.js";import{T as se,C as te}from"./ConfirmDialog-CB93VpMU.js";import{I as re}from"./ImagePreviewModal-C9kBfptX.js";import{U as A}from"./users-zlOYBZNC.js";import{P as ae}from"./plus-6o0HDUdZ.js";import{G as oe}from"./grip-vertical-DqfF9Z58.js";import{E as ne}from"./eye-ZqdX0EnL.js";import{S as le}from"./square-pen-C4bixWX0.js";import{U as ie}from"./upload-C_HNhc83.js";/* empty css            */import"./utils-ByVO39G5.js";import"./button-6AdoFgD4.js";import"./index-D_M2-B-U.js";import"./index-CcIlyOIQ.js";import"./proxy-0qH9_3me.js";import"./index-w_94M6Cx.js";import"./index-CMWG4mbA.js";import"./book-open-C6rtYyhS.js";import"./megaphone-CMRzvPSM.js";import"./landmark-CVelIAil.js";import"./tag-BUSNYjVl.js";import"./chevron-right-DqaPTcHv.js";import"./download-BBhA0ewE.js";const ce=[{value:"Users",label:"Utilisateurs"},{value:"Landmark",label:"Monument"},{value:"MapPin",label:"Carte"},{value:"Award",label:"Récompense"},{value:"Heart",label:"Cœur"},{value:"Briefcase",label:"Valise"},{value:"Target",label:"Cible"},{value:"FileText",label:"Document"}],de=()=>{const{addNotification:o}=_(),[b,I]=a.useState([]),[H,R]=a.useState(!0),[$,u]=a.useState(!1),[F,T]=a.useState(!1),[c,U]=a.useState(null),[y,v]=a.useState({open:!1,id:null}),[G,q]=a.useState(!1),[N,P]=a.useState({open:!1,url:"",title:""}),[d,w]=a.useState({}),[L,C]=a.useState(null),x=a.useRef(null),[r,i]=a.useState({nom:"",role:"",focus:"",icon:"Users",actif:!0}),[M,E]=a.useState(null),[g,S]=a.useState(null);a.useEffect(()=>{h()},[]);const h=async()=>{try{const t=await(await fetch("/admin/api/adjoints")).json();I(t),R(!1)}catch(s){console.error("Erreur lors de la récupération des adjoints:",s),o("error","Erreur lors du chargement des adjoints"),R(!1)}},j=()=>{i({nom:"",role:"",focus:"",icon:"Users",actif:!0}),E(null),C(null),w({}),x.current&&(x.current.value=""),U(null)},K=s=>{i({nom:s.nom,role:s.role,focus:s.focus||"",icon:s.icon||"Users",actif:s.actif}),E(null),x.current&&(x.current.value=""),C(s.photo_url),U(s.id),u(!0)},V=async s=>{s.preventDefault(),T(!0),w({});try{const t=new FormData;t.append("nom",r.nom),t.append("role",r.role),t.append("focus",r.focus||""),t.append("icon",r.icon),t.append("actif",r.actif?"1":"0"),M&&t.append("photo",M),c&&t.append("_method","PUT");const n=document.querySelector('meta[name="csrf-token"]')?.content??"",p=c?`/admin/api/adjoints/${c}`:"/admin/api/adjoints",f=await fetch(p,{method:"POST",headers:{"X-CSRF-TOKEN":n,"X-Requested-With":"XMLHttpRequest"},body:t});if(!f.ok){const m=await f.json();throw m?.errors&&w(m.errors),new Error(m.message||"Erreur de sauvegarde")}const D=await f.json();o("success",D.message||(c?"Adjoint modifié":"Adjoint créé")),u(!1),j(),h()}catch(t){console.error(t),o("error",t instanceof Error?t.message:"Impossible de sauvegarder l'adjoint")}finally{T(!1)}},W=s=>{v({open:!0,id:s})},z=async()=>{if(y.id){q(!0);try{const s=document.querySelector('meta[name="csrf-token"]')?.content??"",t=await fetch(`/admin/api/adjoints/${y.id}`,{method:"DELETE",headers:{"X-CSRF-TOKEN":s,"X-Requested-With":"XMLHttpRequest"}});if(!t.ok){const p=await t.json();throw new Error(p.message||"Erreur de suppression")}const n=await t.json();o("success",n.message||"Adjoint supprimé"),v({open:!1,id:null}),h()}catch(s){console.error(s),o("error",s instanceof Error?s.message:"Impossible de supprimer l'adjoint")}finally{q(!1)}}},J=s=>{const t=s.target.files?.[0];t&&(E(t),C(URL.createObjectURL(t)))},B=(s,t)=>{S(t),s.dataTransfer.effectAllowed="move"},Q=s=>{s.preventDefault(),s.dataTransfer.dropEffect="move"},Y=async(s,t)=>{if(s.preventDefault(),!g||g===t){S(null);return}const n=[...b],p=n.findIndex(l=>l.id===g),f=n.findIndex(l=>l.id===t),[D]=n.splice(p,1);n.splice(f,0,D);const m=n.map((l,k)=>({...l,ordre:k+1}));I(m),S(null);try{const l=document.querySelector('meta[name="csrf-token"]')?.content??"",k=m.map(O=>({id:O.id,ordre:O.ordre}));if(!(await fetch("/admin/api/adjoints/update-order",{method:"POST",headers:{"X-CSRF-TOKEN":l,"X-Requested-With":"XMLHttpRequest","Content-Type":"application/json"},body:JSON.stringify({orders:k})})).ok)throw new Error("Erreur lors de la mise à jour de l'ordre");o("success","Ordre mis à jour")}catch(l){console.error(l),o("error","Erreur lors de la mise à jour de l'ordre"),h()}};return H?e.jsxs("div",{className:"flex flex-col gap-6 p-4",children:[e.jsx(X,{title:"Adjoints au maire"}),e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"text-gray-500",children:"Chargement des adjoints..."})})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-col gap-6 p-4",children:[e.jsx(X,{title:"Adjoints au maire"}),e.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex h-10 w-10 items-center justify-center rounded-lg bg-orange-100",children:e.jsx(A,{className:"h-5 w-5 text-[#f8812f]"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Adjoints au maire"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Gestion des adjoints au maire (ordre modifiable par glisser-déposer)"})]})]}),e.jsxs("button",{onClick:()=>{j(),u(!0)},className:"inline-flex items-center gap-2 rounded-lg bg-[#f8812f] px-4 py-2 text-sm font-semibold text-white shadow-sm hover:bg-orange-600 transition-colors",children:[e.jsx(ae,{className:"h-4 w-4"}),"Nouvel adjoint"]})]}),e.jsx("div",{className:"rounded-xl border border-gray-200 bg-white shadow-sm",children:b.length===0?e.jsxs("div",{className:"p-12 text-center",children:[e.jsx(A,{className:"mx-auto h-12 w-12 text-[#03800a]"}),e.jsx("h3",{className:"mt-4 text-lg font-semibold text-gray-900",children:"Aucun adjoint"}),e.jsx("p",{className:"mt-2 text-sm text-gray-500",children:"Commencez par ajouter un adjoint au maire"})]}):e.jsx("div",{className:"divide-y divide-gray-200",children:b.map(s=>e.jsxs("div",{draggable:!0,onDragStart:t=>B(t,s.id),onDragOver:Q,onDrop:t=>Y(t,s.id),className:`flex items-center gap-4 p-4 transition-colors ${g===s.id?"opacity-50":"hover:bg-gray-50"} ${s.actif?"":"bg-gray-50"}`,children:[e.jsx("div",{className:"cursor-move text-gray-400 hover:text-[#03800a]",children:e.jsx(oe,{className:"h-5 w-5"})}),e.jsx("div",{className:"flex-shrink-0",children:s.photo_url?e.jsxs("button",{onClick:()=>P({open:!0,url:s.photo_url,title:s.nom}),className:"relative group",children:[e.jsx("img",{src:s.photo_url,alt:s.nom,className:"h-16 w-16 rounded-lg object-cover ring-2 ring-gray-200 group-hover:ring-[#f8812f] transition-all"}),e.jsx("div",{className:"absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 transition-opacity rounded-lg flex items-center justify-center",children:e.jsx(ne,{className:"h-5 w-5 text-white"})})]}):e.jsx("div",{className:"h-16 w-16 rounded-lg bg-gray-100 flex items-center justify-center",children:e.jsx(A,{className:"h-8 w-8 text-gray-400"})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"text-base font-semibold text-gray-900",children:s.nom}),!s.actif&&e.jsx("span",{className:"inline-flex items-center rounded-full bg-gray-100 px-2 py-0.5 text-xs font-medium text-gray-600",children:"Inactif"})]}),e.jsx("p",{className:"text-sm text-gray-600",children:s.role}),s.focus&&e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:s.focus})]}),e.jsx("div",{className:"text-center",children:e.jsx("span",{className:"inline-flex h-8 w-8 items-center justify-center rounded-full bg-green-100 text-sm font-semibold text-[#03800a]",children:s.ordre})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>K(s),className:"rounded p-2 text-blue-600 hover:bg-blue-50 transition-colors",title:"Éditer",children:e.jsx(le,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>W(s.id),className:"rounded p-2 text-red-600 hover:bg-red-50 transition-colors",title:"Supprimer",children:e.jsx(se,{className:"h-4 w-4"})})]})]},s.id))})})]}),$&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40 px-4 overflow-y-auto py-6",children:e.jsxs("div",{className:"w-full max-w-2xl rounded-2xl bg-white shadow-2xl",children:[e.jsxs("div",{className:"flex items-center justify-between border-b px-6 py-4",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-xs uppercase tracking-wide text-gray-500",children:[c?"Modifier":"Nouvel"," adjoint"]}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:c?"Modifier l'adjoint":"Ajouter un adjoint"})]}),e.jsx("button",{onClick:()=>{u(!1),j()},className:"rounded-full p-2 text-gray-500 hover:bg-gray-100",children:e.jsx(ee,{className:"h-5 w-5"})})]}),e.jsxs("form",{className:"space-y-4 px-6 py-5",onSubmit:V,children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Nom *"}),e.jsx("input",{required:!0,value:r.nom,onChange:s=>i({...r,nom:s.target.value}),className:"mt-1 w-full rounded-lg border border-gray-200 px-3 py-2 focus:border-[#f8812f] focus:outline-none focus:ring-2 focus:ring-orange-200",placeholder:"Ex: Jean Dupont"}),d.nom?.[0]&&e.jsx("p",{className:"mt-1 text-xs text-red-600",children:d.nom[0]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Rôle *"}),e.jsx("input",{required:!0,value:r.role,onChange:s=>i({...r,role:s.target.value}),className:"mt-1 w-full rounded-lg border border-gray-200 px-3 py-2 focus:border-[#f8812f] focus:outline-none focus:ring-2 focus:ring-orange-200",placeholder:"Ex: 4ème adjoint"}),d.role?.[0]&&e.jsx("p",{className:"mt-1 text-xs text-red-600",children:d.role[0]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Domaine d'action (optionnel)"}),e.jsx("input",{value:r.focus,onChange:s=>i({...r,focus:s.target.value}),className:"mt-1 w-full rounded-lg border border-gray-200 px-3 py-2 focus:border-[#f8812f] focus:outline-none focus:ring-2 focus:ring-orange-200",placeholder:"Ex: Vie citoyenne & proximité"}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Peut être laissé vide"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Icône"}),e.jsx("select",{value:r.icon,onChange:s=>i({...r,icon:s.target.value}),className:"mt-1 w-full rounded-lg border border-gray-200 px-3 py-2 focus:border-[#f8812f] focus:outline-none focus:ring-2 focus:ring-orange-200",children:ce.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Photo"}),L&&e.jsx("div",{className:"mt-2 mb-3",children:e.jsx("img",{src:L,alt:"Aperçu",className:"h-32 w-32 rounded-lg object-cover border-2 border-orange-200"})}),e.jsxs("label",{className:"mt-2 flex cursor-pointer items-center gap-2 rounded-lg border-2 border-dashed border-gray-300 px-4 py-3 hover:border-[#f8812f] hover:bg-orange-50 transition-colors",children:[e.jsx(ie,{className:"h-5 w-5 text-gray-500"}),e.jsx("span",{className:"text-sm text-gray-600",children:"Choisir une photo"}),e.jsx("input",{type:"file",accept:"image/*",onChange:J,ref:x,className:"hidden"})]}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Format image, max 4 Mo"}),d.photo?.[0]&&e.jsx("p",{className:"mt-2 text-xs text-red-600",children:d.photo[0]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",id:"actif",checked:r.actif,onChange:s=>i({...r,actif:s.target.checked}),className:"h-4 w-4 rounded border-gray-300 text-[#03800a] focus:ring-[#03800a]"}),e.jsx("label",{htmlFor:"actif",className:"text-sm font-medium text-gray-700",children:"Actif (visible sur le site)"})]}),e.jsxs("div",{className:"flex items-center justify-end gap-3 border-t pt-4",children:[e.jsx("button",{type:"button",onClick:()=>{u(!1),j()},className:"rounded-lg px-4 py-2 text-sm font-semibold text-gray-600 hover:bg-gray-100",children:"Annuler"}),e.jsx("button",{type:"submit",disabled:F,className:"rounded-lg bg-[#03800a] px-5 py-2 text-sm font-semibold text-white shadow-sm hover:bg-green-700 disabled:opacity-60",children:F?"Enregistrement...":"Enregistrer"})]})]})]})}),e.jsx(te,{open:y.open,onClose:()=>v({open:!1,id:null}),onConfirm:z,title:"Supprimer cet adjoint ?",message:"Cette action est irréversible. L'adjoint sera définitivement supprimé.",confirmText:"Supprimer",type:"danger",loading:G}),e.jsx(re,{open:N.open,onClose:()=>P({open:!1,url:"",title:""}),imageUrl:N.url,title:N.title})]})};de.layout=o=>e.jsx(Z,{children:o});export{de as default};
