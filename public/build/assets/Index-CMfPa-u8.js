import{u as K,r,j as e,H as W}from"./app-BOeBlu4b.js";import{l as p,a as G,L as B}from"./listing-DCR793qH.js";import{L as Q}from"./ListingToolbar-yJFCtgWV.js";import{A as Y}from"./app-layout-01HyJkhw.js";import{u as Z,X as ee}from"./NotificationContainer-DsMHCjNZ.js";import{T as te,C as se}from"./ConfirmDialog-BQnA4M2F.js";import{I as re}from"./ImagePreviewModal-DSzB5LBr.js";import{P as ae}from"./plus-BrowsBK3.js";import{F as le}from"./file-text-C2L8AdYa.js";import{I}from"./image-CrTrKhxx.js";import{S as ie}from"./square-pen-pwgSHEdM.js";/* empty css            */import"./utils-Y8vIEmjK.js";import"./button-BAOKhKj2.js";import"./index-zbMUL0ku.js";import"./index-ky7ia0w0.js";import"./proxy-BomrNsxp.js";import"./index-w_94M6Cx.js";import"./index-CMWG4mbA.js";import"./book-open-CkQh-Dm6.js";import"./megaphone-CUfDwg7a.js";import"./tag-D1ZlLnvX.js";import"./users-m-PM2a8u.js";import"./chevron-right-DhTCxD4C.js";import"./download-CrxwCkyw.js";const ne=({editions:u=[],listing:g})=>{const{addNotification:h}=Z(),{url:M}=K(),i=M.split("?")[0],[f,X]=r.useState(g?.filters.search??""),j=g?.filters.sort??"published_at",b=g?.filters.direction??"desc",c=g?.pagination??{page:1,per_page:15,total:u.length,last_page:1},n=r.useMemo(()=>({search:f,sort:j,direction:b,per_page:c.per_page}),[c.per_page,f,b,j]),[U,m]=r.useState(!1),[P,D]=r.useState(!1),[d,E]=r.useState(null),[y,N]=r.useState({open:!1,id:null}),[z,F]=r.useState(!1),[v,w]=r.useState({open:!1,url:"",title:""}),[a,o]=r.useState({title:"",description:"",published_at:"",ordre:"0",actif:!0}),[k,T]=r.useState(null),[L,O]=r.useState(null),[R,_]=r.useState(null),A=()=>{o({title:"",description:"",published_at:"",ordre:"0",actif:!0}),T(null),O(null),_(null),E(null)},H=t=>{o({title:t.title??"",description:t.description??"",published_at:t.published_at??"",ordre:String(t.ordre??0),actif:t.actif}),_(t.cover_image_url??null),E(t.id),m(!0)},J=async t=>{t.preventDefault(),D(!0);try{const s=document.querySelector('meta[name="csrf-token"]')?.content??"",l=new FormData;Object.entries(a).forEach(([x,q])=>{x==="actif"?l.append(x,q?"1":"0"):l.append(x,q??"")}),k&&l.append("file",k),L&&l.append("cover_image",L);const C=d?`/admin/api/journal/${d}`:"/admin/api/journal";d&&l.append("_method","PUT");const S=await fetch(C,{method:"POST",headers:{"X-CSRF-TOKEN":s,"X-Requested-With":"XMLHttpRequest"},body:l});if(!S.ok){const x=await S.json();throw new Error(x.message||"Erreur de sauvegarde")}const $=await S.json();h("success",$.message||(d?"Édition mise à jour":"Édition créée")),m(!1),A(),p(i,{...n,page:1})}catch(s){console.error(s),h("error",s instanceof Error?s.message:"Impossible de sauvegarder")}finally{D(!1)}},V=async()=>{if(y.id){F(!0);try{const t=document.querySelector('meta[name="csrf-token"]')?.content??"",s=await fetch(`/admin/api/journal/${y.id}`,{method:"DELETE",headers:{"X-CSRF-TOKEN":t,"X-Requested-With":"XMLHttpRequest"}});if(!s.ok){const C=await s.json();throw new Error(C.message||"Erreur de suppression")}const l=await s.json();h("success",l.message||"Édition supprimée"),N({open:!1,id:null}),p(i,n)}catch(t){console.error(t),h("error",t instanceof Error?t.message:"Impossible de supprimer")}finally{F(!1)}}};return e.jsxs("div",{className:"flex flex-col gap-6 p-4",children:[e.jsx(W,{title:"Journal municipal"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm uppercase tracking-wide text-gray-500",children:"Communication"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Journal municipal"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Gérer les éditions PDF affichées sur le site."})]}),e.jsxs("button",{onClick:()=>{A(),m(!0)},className:"inline-flex items-center gap-2 rounded-lg bg-[#03800a] px-4 py-2 text-sm font-semibold text-white shadow-sm hover:bg-[#166e7b]",children:[e.jsx(ae,{className:"h-4 w-4"}),"Nouvelle édition"]})]}),e.jsx(Q,{search:f,perPage:c.per_page,sort:{value:j,direction:b},sortOptions:[{value:"published_at",label:"Date"},{value:"title",label:"Titre"},{value:"created_at",label:"Création"},{value:"ordre",label:"Ordre"}],onSearchChange:X,onSearchSubmit:()=>p(i,{...n,page:1}),onPerPageChange:t=>p(i,{...n,per_page:t,page:1}),onExport:t=>G(i,n,t),onSortChange:(t,s)=>p(i,{...n,sort:t,direction:s})}),e.jsx("div",{className:"rounded-xl border border-gray-200 bg-white p-0 shadow-sm",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-50 text-left text-xs uppercase text-gray-500",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3",children:"Titre"}),e.jsx("th",{className:"px-4 py-3",children:"Date"}),e.jsx("th",{className:"px-4 py-3",children:"Ordre"}),e.jsx("th",{className:"px-4 py-3",children:"Taille"}),e.jsx("th",{className:"px-4 py-3",children:"Actif"}),e.jsx("th",{className:"px-4 py-3",children:"Fichier"}),e.jsx("th",{className:"px-4 py-3",children:"Cover"}),e.jsx("th",{className:"px-4 py-3",children:"Actions"})]})}),e.jsx("tbody",{children:u.length?u.map(t=>e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"px-4 py-3 font-medium text-gray-900",children:t.title}),e.jsx("td",{className:"px-4 py-3 text-gray-700",children:t.published_at?new Date(t.published_at).toLocaleDateString("fr-FR"):"—"}),e.jsx("td",{className:"px-4 py-3 text-gray-700",children:t.ordre??0}),e.jsx("td",{className:"px-4 py-3 text-gray-700",children:t.file_size_label||(t.file_size?`${t.file_size} o`:"—")}),e.jsx("td",{className:"px-4 py-3 text-gray-700",children:t.actif?"Oui":"Non"}),e.jsx("td",{className:"px-4 py-3",children:t.file_url?e.jsxs("a",{href:t.file_url,target:"_blank",rel:"noreferrer",className:"inline-flex items-center gap-1 text-blue-600 hover:underline",children:[e.jsx(le,{className:"h-4 w-4"}),"PDF"]}):"—"}),e.jsx("td",{className:"px-4 py-3",children:t.cover_image_url?e.jsxs("button",{type:"button",className:"inline-flex items-center gap-1 text-gray-700 hover:underline",onClick:()=>w({open:!0,url:t.cover_image_url||"",title:t.title}),children:[e.jsx(I,{className:"h-4 w-4"}),"Voir"]}):"—"}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>H(t),className:"rounded p-1.5 text-blue-600 hover:bg-blue-50 transition-colors",title:"Éditer",children:e.jsx(ie,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>N({open:!0,id:t.id}),className:"rounded p-1.5 text-red-600 hover:bg-red-50 transition-colors",title:"Supprimer",children:e.jsx(te,{className:"h-4 w-4"})})]})})]},t.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:8,className:"px-4 py-6 text-center text-gray-500",children:"Aucune édition pour le moment."})})})]})})}),e.jsx(B,{page:c.page,lastPage:c.last_page,total:c.total,onPageChange:t=>p(i,{...n,page:t})}),U&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40 px-4",children:e.jsxs("div",{className:"w-full max-w-2xl rounded-2xl bg-white shadow-2xl",children:[e.jsxs("div",{className:"flex items-center justify-between border-b px-6 py-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-wide text-gray-500",children:"Édition du journal"}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:d?"Éditer l’édition":"Nouvelle édition"})]}),e.jsx("button",{className:"rounded-full p-2 text-gray-500 hover:bg-gray-100",onClick:()=>m(!1),children:e.jsx(ee,{className:"h-5 w-5"})})]}),e.jsxs("form",{className:"space-y-4 px-6 py-5",onSubmit:J,children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Titre *"}),e.jsx("input",{required:!0,value:a.title,onChange:t=>o({...a,title:t.target.value}),className:"mt-1 w-full rounded-lg border border-gray-200 px-3 py-2 focus:border-[#03800a] focus:outline-none focus:ring-2 focus:ring-[#03800a]/20",placeholder:"Titre de l'édition"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Date"}),e.jsx("input",{type:"date",value:a.published_at,onChange:t=>o({...a,published_at:t.target.value}),className:"mt-1 w-full rounded-lg border border-gray-200 px-3 py-2 focus:border-[#03800a] focus:outline-none focus:ring-2 focus:ring-[#03800a]/20"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Description"}),e.jsx("textarea",{value:a.description,onChange:t=>o({...a,description:t.target.value}),rows:3,className:"mt-1 w-full rounded-lg border border-gray-200 px-3 py-2 focus:border-[#03800a] focus:outline-none focus:ring-2 focus:ring-[#03800a]/20",placeholder:"Résumé de l'édition"})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"PDF *"}),e.jsx("input",{type:"file",accept:"application/pdf",required:!d,onChange:t=>T(t.target.files?.[0]??null),className:"mt-1 w-full rounded-lg border border-gray-200 px-3 py-2 focus:border-[#03800a] focus:outline-none focus:ring-2 focus:ring-[#03800a]/20"}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"PDF, max 20 Mo."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Cover"}),e.jsx("input",{type:"file",accept:"image/*",onChange:t=>{const s=t.target.files?.[0]??null;O(s),_(s?URL.createObjectURL(s):null)},className:"mt-1 w-full rounded-lg border border-gray-200 px-3 py-2 focus:border-[#03800a] focus:outline-none focus:ring-2 focus:ring-[#03800a]/20"}),R&&e.jsxs("button",{type:"button",onClick:()=>w({open:!0,url:R,title:"Aperçu cover"}),className:"mt-2 inline-flex items-center gap-2 text-xs text-[#03800a] hover:underline",children:[e.jsx(I,{className:"h-4 w-4"}),"Aperçu cover"]})]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Ordre"}),e.jsx("input",{type:"number",min:0,value:a.ordre,onChange:t=>o({...a,ordre:t.target.value}),className:"mt-1 w-full rounded-lg border border-gray-200 px-3 py-2 focus:border-[#03800a] focus:outline-none focus:ring-2 focus:ring-[#03800a]/20"})]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm text-gray-700 mt-6",children:[e.jsx("input",{type:"checkbox",checked:a.actif,onChange:t=>o({...a,actif:t.target.checked}),className:"h-4 w-4 rounded border-gray-300 text-[#03800a] focus:ring-[#03800a]"}),"Actif"]})]}),e.jsxs("div",{className:"flex items-center justify-end gap-3 border-t pt-4",children:[e.jsx("button",{type:"button",className:"rounded-lg px-4 py-2 text-sm font-semibold text-gray-600 hover:bg-gray-100",onClick:()=>m(!1),children:"Annuler"}),e.jsx("button",{type:"submit",disabled:P,className:"rounded-lg bg-[#03800a] px-5 py-2 text-sm font-semibold text-white shadow-sm hover:bg-[#166e7b] disabled:opacity-60",children:P?"Enregistrement...":"Enregistrer"})]})]})]})}),e.jsx(se,{open:y.open,onClose:()=>N({open:!1,id:null}),onConfirm:V,title:"Supprimer cette édition ?",message:"Cette action est irréversible. L'édition sera définitivement supprimée.",confirmText:"Supprimer",type:"danger",loading:z}),e.jsx(re,{open:v.open,onClose:()=>w({open:!1,url:"",title:""}),imageUrl:v.url,title:v.title})]})};ne.layout=u=>e.jsx(Y,{children:u});export{ne as default};
