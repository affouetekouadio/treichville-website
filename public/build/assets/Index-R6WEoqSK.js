import{u as A,r as o,j as e,H as O}from"./app-BOeBlu4b.js";import{l as c,a as H,L as V}from"./listing-DCR793qH.js";import{L as z}from"./ListingToolbar-yJFCtgWV.js";import{A as I}from"./app-layout-01HyJkhw.js";import{u as K}from"./use-listing-search-Dn3WOJ1W.js";import{u as U,C as k,a as E,A as W,X as _,M as D}from"./NotificationContainer-DsMHCjNZ.js";import{T as M,C as B}from"./ConfirmDialog-BQnA4M2F.js";import{E as J}from"./eye-CO2Nf5nM.js";import{m as P}from"./proxy-BomrNsxp.js";import{P as G}from"./phone-StNE8aC9.js";import{C as Q}from"./calendar-D9q9_0jx.js";/* empty css            */import"./utils-Y8vIEmjK.js";import"./button-BAOKhKj2.js";import"./index-zbMUL0ku.js";import"./index-ky7ia0w0.js";import"./index-w_94M6Cx.js";import"./index-CMWG4mbA.js";import"./book-open-CkQh-Dm6.js";import"./megaphone-CUfDwg7a.js";import"./tag-D1ZlLnvX.js";import"./users-m-PM2a8u.js";import"./chevron-right-DhTCxD4C.js";const Y=({contacts:d=[],listing:x})=>{const{addNotification:p}=U(),{url:T}=A(),a=T.split("?")[0],[u,L]=o.useState(x?.filters.search??""),h=x?.filters.sort??"created_at",j=x?.filters.direction??"desc",n=x?.pagination??{page:1,per_page:15,total:d.length,last_page:1},r=o.useMemo(()=>({search:u,sort:h,direction:j,per_page:n.per_page}),[n.per_page,u,j,h]);K(a,r);const[s,m]=o.useState({open:!1,contact:null}),[b,f]=o.useState({open:!1,id:null}),[q,v]=o.useState(!1),[w,C]=o.useState(!1),R=t=>{m({open:!0,contact:t}),t.traite||N(t.id,!0,!1)},N=async(t,l,g=!0)=>{C(!0);try{const i=document.querySelector('meta[name="csrf-token"]')?.content??"",y=await fetch(`/admin/api/contacts/${t}/toggle-status`,{method:"POST",headers:{"X-CSRF-TOKEN":i,"X-Requested-With":"XMLHttpRequest","Content-Type":"application/json"},body:JSON.stringify({traite:l})});if(!y.ok){const X=await y.json();throw new Error(X.message||"Erreur lors de la mise à jour")}const F=await y.json();g&&p("success",F.message||"Statut mis à jour"),c(a,r)}catch(i){console.error(i),g&&p("error",i instanceof Error?i.message:"Impossible de mettre à jour le statut")}finally{C(!1)}},S=t=>{f({open:!0,id:t})},$=async()=>{if(b.id){v(!0);try{const t=document.querySelector('meta[name="csrf-token"]')?.content??"",l=await fetch(`/admin/api/contacts/${b.id}`,{method:"DELETE",headers:{"X-CSRF-TOKEN":t,"X-Requested-With":"XMLHttpRequest"}});if(!l.ok){const i=await l.json();throw new Error(i.message||"Erreur de suppression")}const g=await l.json();p("success",g.message||"Message supprimé"),f({open:!1,id:null}),c(a,r)}catch(t){console.error(t),p("error",t instanceof Error?t.message:"Impossible de supprimer le message")}finally{v(!1)}}};return e.jsxs("div",{className:"flex flex-col gap-6 p-4",children:[e.jsx(O,{title:"Contacts"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm uppercase tracking-wide text-gray-500",children:"Messagerie"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Messages de contact"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Consultez les messages envoyés via le formulaire de contact."})]}),e.jsx(z,{search:u,perPage:n.per_page,sort:{value:h,direction:j},sortOptions:[{value:"created_at",label:"Date"},{value:"nom",label:"Nom"},{value:"email",label:"Email"},{value:"sujet",label:"Sujet"},{value:"traite",label:"Statut"}],onSearchChange:L,onSearchSubmit:()=>c(a,{...r,page:1}),onPerPageChange:t=>c(a,{...r,per_page:t,page:1}),onExport:t=>H(a,r,t),onSortChange:(t,l)=>c(a,{...r,sort:t,direction:l})}),e.jsx("div",{className:"rounded-xl border border-gray-200 bg-white p-0 shadow-sm",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-50 text-left text-xs uppercase text-gray-500",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3",children:"Statut"}),e.jsx("th",{className:"px-4 py-3",children:"Date"}),e.jsx("th",{className:"px-4 py-3",children:"Nom"}),e.jsx("th",{className:"px-4 py-3",children:"Email"}),e.jsx("th",{className:"px-4 py-3",children:"Sujet"}),e.jsx("th",{className:"px-4 py-3",children:"Message"}),e.jsx("th",{className:"px-4 py-3",children:"Actions"})]})}),e.jsx("tbody",{children:d.length?d.map(t=>e.jsxs("tr",{className:`border-t align-top transition-colors ${t.traite?"":"bg-blue-50/30"}`,children:[e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:`inline-flex items-center rounded-full px-2.5 py-1 text-xs font-semibold ${t.traite?"bg-emerald-100 text-emerald-700":"bg-amber-100 text-amber-700"}`,children:t.traite?"Traité":"Nouveau"})}),e.jsx("td",{className:"px-4 py-3 text-gray-600 text-xs",children:new Date(t.created_at).toLocaleString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})}),e.jsx("td",{className:"px-4 py-3 font-medium text-gray-900",children:t.nom}),e.jsx("td",{className:"px-4 py-3 text-gray-700",children:t.email}),e.jsx("td",{className:"px-4 py-3 text-gray-700 font-medium",children:t.sujet}),e.jsx("td",{className:"px-4 py-3 text-gray-600",children:e.jsx("div",{className:"max-w-xs truncate",title:t.message,children:t.message})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>R(t),className:"rounded p-1.5 text-blue-600 hover:bg-blue-50 transition-colors",title:"Voir les détails",children:e.jsx(J,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>N(t.id,!t.traite),disabled:w,className:`rounded p-1.5 transition-colors ${t.traite?"text-amber-600 hover:bg-amber-50":"text-emerald-600 hover:bg-emerald-50"} disabled:opacity-50`,title:t.traite?"Marquer comme non lu":"Marquer comme lu",children:t.traite?e.jsx(k,{className:"h-4 w-4"}):e.jsx(E,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>S(t.id),className:"rounded p-1.5 text-red-600 hover:bg-red-50 transition-colors",title:"Supprimer",children:e.jsx(M,{className:"h-4 w-4"})})]})})]},t.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"px-4 py-6 text-center text-gray-500",children:"Aucun message de contact pour le moment."})})})]})})}),e.jsx(V,{page:n.page,lastPage:n.last_page,total:n.total,onPageChange:t=>c(a,{...r,page:t})}),e.jsx(W,{children:s.open&&s.contact&&e.jsxs(e.Fragment,{children:[e.jsx(P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},className:"fixed inset-0 z-50 bg-black/40 backdrop-blur-sm",onClick:()=>m({open:!1,contact:null})}),e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:e.jsxs(P.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},transition:{duration:.2},className:"relative max-w-2xl w-full bg-white rounded-2xl shadow-2xl max-h-[90vh] overflow-hidden",onClick:t=>t.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between border-b px-6 py-4 bg-gradient-to-r from-blue-50 to-indigo-50",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Détails du message"}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["Reçu le"," ",new Date(s.contact.created_at).toLocaleDateString("fr-FR",{day:"numeric",month:"long",year:"numeric",hour:"2-digit",minute:"2-digit"})]})]}),e.jsx("button",{onClick:()=>m({open:!1,contact:null}),className:"rounded-full p-2 text-gray-500 hover:bg-white/50 transition-colors",children:e.jsx(_,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"p-6 overflow-y-auto max-h-[calc(90vh-120px)] space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"flex items-start gap-3 p-4 bg-gray-50 rounded-lg",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(D,{className:"h-5 w-5 text-blue-600"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 uppercase tracking-wide",children:"Nom"}),e.jsx("p",{className:"text-sm font-semibold text-gray-900 mt-1",children:s.contact.nom})]})]}),e.jsxs("div",{className:"flex items-start gap-3 p-4 bg-gray-50 rounded-lg",children:[e.jsx("div",{className:"p-2 bg-green-100 rounded-lg",children:e.jsx(D,{className:"h-5 w-5 text-green-600"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 uppercase tracking-wide",children:"Email"}),e.jsx("a",{href:`mailto:${s.contact.email}`,className:"text-sm font-semibold text-blue-600 hover:text-blue-700 mt-1 block truncate",children:s.contact.email})]})]}),s.contact.telephone&&e.jsxs("div",{className:"flex items-start gap-3 p-4 bg-gray-50 rounded-lg",children:[e.jsx("div",{className:"p-2 bg-purple-100 rounded-lg",children:e.jsx(G,{className:"h-5 w-5 text-purple-600"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 uppercase tracking-wide",children:"Téléphone"}),e.jsx("a",{href:`tel:${s.contact.telephone}`,className:"text-sm font-semibold text-blue-600 hover:text-blue-700 mt-1 block",children:s.contact.telephone})]})]}),e.jsxs("div",{className:"flex items-start gap-3 p-4 bg-gray-50 rounded-lg",children:[e.jsx("div",{className:"p-2 bg-amber-100 rounded-lg",children:e.jsx(Q,{className:"h-5 w-5 text-amber-600"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 uppercase tracking-wide",children:"Statut"}),e.jsx("span",{className:`inline-flex items-center rounded-full px-2.5 py-1 text-xs font-semibold mt-1 ${s.contact.traite?"bg-emerald-100 text-emerald-700":"bg-amber-100 text-amber-700"}`,children:s.contact.traite?"Traité":"Nouveau"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Sujet"}),e.jsx("div",{className:"p-4 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg border border-blue-100",children:e.jsx("p",{className:"text-base font-semibold text-gray-900",children:s.contact.sujet})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Message"}),e.jsx("div",{className:"p-4 bg-gray-50 rounded-lg border border-gray-200",children:e.jsx("p",{className:"text-sm text-gray-700 whitespace-pre-wrap leading-relaxed",children:s.contact.message})})]})]}),e.jsxs("div",{className:"border-t px-6 py-4 bg-gray-50 flex items-center justify-between",children:[e.jsx("button",{onClick:()=>N(s.contact.id,!s.contact.traite),disabled:w,className:`inline-flex items-center gap-2 px-4 py-2 rounded-lg font-semibold text-sm transition-colors disabled:opacity-50 ${s.contact.traite?"bg-amber-100 text-amber-700 hover:bg-amber-200":"bg-emerald-100 text-emerald-700 hover:bg-emerald-200"}`,children:s.contact.traite?e.jsxs(e.Fragment,{children:[e.jsx(k,{className:"h-4 w-4"}),"Marquer comme non lu"]}):e.jsxs(e.Fragment,{children:[e.jsx(E,{className:"h-4 w-4"}),"Marquer comme lu"]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>{m({open:!1,contact:null}),S(s.contact.id)},className:"inline-flex items-center gap-2 px-4 py-2 rounded-lg bg-red-100 text-red-700 hover:bg-red-200 font-semibold text-sm transition-colors",children:[e.jsx(M,{className:"h-4 w-4"}),"Supprimer"]}),e.jsx("button",{onClick:()=>m({open:!1,contact:null}),className:"px-4 py-2 rounded-lg bg-gray-200 text-gray-700 hover:bg-gray-300 font-semibold text-sm transition-colors",children:"Fermer"})]})]})]})})]})}),e.jsx(B,{open:b.open,onClose:()=>f({open:!1,id:null}),onConfirm:$,title:"Supprimer ce message ?",message:"Cette action est irréversible. Le message sera définitivement supprimé.",confirmText:"Supprimer",type:"danger",loading:q})]})};Y.layout=d=>e.jsx(I,{children:d});export{Y as default};
