import{u as $,r as a,j as e,H as B}from"./app-zp8a_1Kz.js";import{a as V,l as c,L as W}from"./listing-CyK14IAB.js";import{L as z}from"./ListingToolbar-BSqKS32_.js";import{A as G}from"./app-layout-CePoWWuH.js";import{R as J}from"./RichTextEditor-Dl7IrOZS.js";import{u as Q}from"./use-listing-search-E-iLxo6C.js";import{u as Y,X as Z}from"./NotificationContainer-gxxL-dmH.js";import{T as ee,C as te}from"./ConfirmDialog-Br3_tiJq.js";import{I as se}from"./ImagePreviewModal-b_Jp4KPZ.js";import{P as re}from"./plus-CUhRo2XF.js";import{I as ae}from"./image-BxdpKVyZ.js";import{E as ie}from"./eye-BVJGR6gk.js";import{S as oe}from"./square-pen-CR4kVuYF.js";/* empty css            */import"./utils-BXHwvztH.js";import"./button-CiEhR-Zp.js";import"./index-BJyFvceU.js";import"./index-Cn9ca9qa.js";import"./proxy-CiNOm1L4.js";import"./index-w_94M6Cx.js";import"./index-CMWG4mbA.js";import"./book-open-BMmTLku0.js";import"./megaphone-9k5Y78Jh.js";import"./landmark-CZwsELM-.js";import"./tag-CRsMMEZF.js";import"./users-CfERKPYF.js";import"./chevron-right-D4ZEOqXu.js";import"./download-BEF9xMVZ.js";const le=({patrimoines:u=[],listing:g})=>{const{addNotification:x}=Y(),{url:L}=$(),i=L.split("?")[0],[f,F]=a.useState(g?.filters.search??""),h=g?.filters.sort??"created_at",b=g?.filters.direction??"desc",n=g?.pagination??{page:1,per_page:15,total:u.length,last_page:1},o=a.useMemo(()=>({search:f,sort:h,direction:b,per_page:n.per_page}),[n.per_page,f,b,h]);Q(i,o);const[q,m]=a.useState(!1),[C,S]=a.useState(!1),[p,E]=a.useState(null),[j,y]=a.useState({open:!1,id:null}),[M,P]=a.useState(!1),[v,T]=a.useState({open:!1,url:"",title:""}),[r,l]=a.useState({titre:"",lieu:"",status:"published",published_at:"",description:""}),[D,_]=a.useState(null),k=()=>{l({titre:"",lieu:"",status:"published",published_at:"",description:""}),_(null),E(null)},R=async t=>{t.preventDefault(),S(!0);try{const s=document.querySelector('meta[name="csrf-token"]')?.content??"",d=new FormData;Object.entries(r).forEach(([w,U])=>d.append(w,U??"")),D&&d.append("image",D),p&&d.append("_method","PUT");const H=p?`/admin/api/patrimoines/${p}`:"/admin/api/patrimoines",N=await fetch(H,{method:"POST",headers:{"X-CSRF-TOKEN":s,"X-Requested-With":"XMLHttpRequest"},body:d});if(!N.ok){const w=await N.json();throw new Error(w.message||"Erreur de sauvegarde")}const K=await N.json();x("success",K.message||(p?"Patrimoine modifié":"Patrimoine créé")),m(!1),k(),c(i,{...o,page:1})}catch(s){console.error(s),x("error",s instanceof Error?s.message:"Impossible de sauvegarder le patrimoine")}finally{S(!1)}},O=t=>{l({titre:t.titre,lieu:t.lieu||"",status:t.status||"draft",published_at:t.published_at?t.published_at.split("T")[0]:"",description:t.description||""}),E(t.id),m(!0)},X=t=>{y({open:!0,id:t})},A=async()=>{if(j.id){P(!0);try{const t=document.querySelector('meta[name="csrf-token"]')?.content??"",s=await fetch(`/admin/api/patrimoines/${j.id}`,{method:"DELETE",headers:{"X-CSRF-TOKEN":t,"X-Requested-With":"XMLHttpRequest"}});if(!s.ok){const d=await s.json();throw new Error(d.message||"Erreur de suppression")}x("success","Patrimoine supprimé"),y({open:!1,id:null}),c(i,{...o,page:n.page})}catch(t){console.error(t),x("error",t instanceof Error?t.message:"Impossible de supprimer")}finally{P(!1)}}},I=(t,s)=>{t&&T({open:!0,url:t,title:s||"Image"})};return e.jsxs("div",{className:"flex flex-col gap-6 p-4",children:[e.jsx(B,{title:"Patrimoines"}),e.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-semibold text-gray-900",children:"Patrimoines"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Monuments, lieux emblématiques et repères institutionnels."})]}),e.jsxs("button",{type:"button",onClick:()=>{k(),m(!0)},className:"inline-flex items-center gap-2 rounded-lg bg-[#03800a] px-4 py-2 text-sm font-semibold text-white shadow-sm hover:bg-[#166e7b]",children:[e.jsx(re,{className:"h-4 w-4"}),"Nouveau patrimoine"]})]}),e.jsx(z,{search:f,perPage:n.per_page,sort:{value:h,direction:b},sortOptions:[{value:"created_at",label:"Date création"},{value:"published_at",label:"Date publication"},{value:"titre",label:"Titre"},{value:"status",label:"Statut"}],onSearchChange:t=>F(t),onSearchSubmit:()=>c(i,{...o,page:1}),onPerPageChange:t=>c(i,{...o,per_page:t,page:1}),onSortChange:(t,s)=>c(i,{...o,sort:t,direction:s,page:1}),onExport:t=>V(i,{...o,export:t})}),e.jsx("div",{className:"rounded-xl border border-gray-200 bg-white shadow-sm",children:e.jsx("div",{className:"divide-y divide-gray-100",children:u.length?u.map(t=>e.jsxs("div",{className:"flex flex-col gap-4 p-4 md:flex-row md:items-center md:justify-between",children:[e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("button",{type:"button",onClick:()=>I(t.image_url,t.titre),className:"h-20 w-28 overflow-hidden rounded-lg border border-gray-200 bg-gray-50",children:t.image_url?e.jsx("img",{src:t.image_url,alt:t.titre,className:"h-full w-full object-cover"}):e.jsx("div",{className:"flex h-full w-full items-center justify-center text-gray-400",children:e.jsx(ae,{className:"h-5 w-5"})})}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm font-semibold text-gray-900",children:t.titre}),t.lieu&&e.jsx("p",{className:"text-xs text-gray-500",children:t.lieu}),e.jsxs("p",{className:"text-xs text-gray-500",children:[t.status==="published"?"Publié":"Brouillon",t.published_at?` • ${t.published_at}`:""]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[t.image_url&&e.jsx("button",{type:"button",onClick:()=>I(t.image_url,t.titre),className:"rounded-lg border border-gray-200 px-3 py-2 text-xs font-semibold text-gray-600 hover:bg-gray-100",children:e.jsx(ie,{className:"h-4 w-4"})}),e.jsx("button",{type:"button",onClick:()=>O(t),className:"rounded-lg border border-gray-200 px-3 py-2 text-xs font-semibold text-gray-600 hover:bg-gray-100",children:e.jsx(oe,{className:"h-4 w-4"})}),e.jsx("button",{type:"button",onClick:()=>X(t.id),className:"rounded-lg border border-red-200 px-3 py-2 text-xs font-semibold text-red-600 hover:bg-red-50",children:e.jsx(ee,{className:"h-4 w-4"})})]})]},t.id)):e.jsx("div",{className:"p-8 text-center text-sm text-gray-500",children:"Aucun patrimoine enregistré."})})}),e.jsx(W,{currentPage:n.page,lastPage:n.last_page,onPageChange:t=>c(i,{...o,page:t})}),q&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40 p-4",children:e.jsxs("div",{className:"w-full max-w-3xl rounded-2xl bg-white p-6 shadow-xl",children:[e.jsxs("div",{className:"flex items-center justify-between border-b pb-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:p?"Modifier le patrimoine":"Nouveau patrimoine"}),e.jsx("button",{type:"button",onClick:()=>m(!1),className:"rounded-full p-2 text-gray-500 hover:bg-gray-100",children:e.jsx(Z,{className:"h-5 w-5"})})]}),e.jsxs("form",{onSubmit:R,className:"mt-4 space-y-4",children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Titre"}),e.jsx("input",{value:r.titre,onChange:t=>l({...r,titre:t.target.value}),className:"mt-1 w-full rounded-lg border border-gray-200 px-3 py-2 focus:border-[#03800a] focus:outline-none focus:ring-2 focus:ring-[#03800a]/20",placeholder:"Titre du patrimoine",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Lieu"}),e.jsx("input",{value:r.lieu,onChange:t=>l({...r,lieu:t.target.value}),className:"mt-1 w-full rounded-lg border border-gray-200 px-3 py-2 focus:border-[#03800a] focus:outline-none focus:ring-2 focus:ring-[#03800a]/20",placeholder:"Ex: Treichville, Abidjan"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Date de publication"}),e.jsx("input",{type:"date",value:r.published_at,onChange:t=>l({...r,published_at:t.target.value}),className:"mt-1 w-full rounded-lg border border-gray-200 px-3 py-2 focus:border-[#03800a] focus:outline-none focus:ring-2 focus:ring-[#03800a]/20"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Statut"}),e.jsxs("select",{value:r.status,onChange:t=>l({...r,status:t.target.value}),className:"mt-1 w-full rounded-lg border border-gray-200 px-3 py-2 focus:border-[#03800a] focus:outline-none focus:ring-2 focus:ring-[#03800a]/20",children:[e.jsx("option",{value:"published",children:"Publié"}),e.jsx("option",{value:"draft",children:"Brouillon"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Description (CKEditor)"}),e.jsx(J,{value:r.description,onChange:t=>l({...r,description:t}),placeholder:"Texte descriptif du patrimoine"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Image principale"}),e.jsx("input",{type:"file",accept:"image/*",onChange:t=>_(t.target.files?.[0]??null),className:"mt-1 w-full rounded-lg border border-gray-200 px-3 py-2 focus:border-[#03800a] focus:outline-none focus:ring-2 focus:ring-[#03800a]/20"}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Formats image, max 4 Mo."})]}),e.jsxs("div",{className:"flex items-center justify-end gap-3 border-t pt-4",children:[e.jsx("button",{type:"button",className:"rounded-lg px-4 py-2 text-sm font-semibold text-gray-600 hover:bg-gray-100",onClick:()=>m(!1),children:"Annuler"}),e.jsx("button",{type:"submit",disabled:C,className:"rounded-lg bg-[#03800a] px-5 py-2 text-sm font-semibold text-white shadow-sm hover:bg-[#166e7b] disabled:opacity-60",children:C?"Enregistrement...":"Enregistrer"})]})]})]})}),e.jsx(te,{open:j.open,onClose:()=>y({open:!1,id:null}),onConfirm:A,title:"Supprimer ce patrimoine ?",message:"Cette action est irréversible. Le patrimoine sera définitivement supprimé.",confirmText:"Supprimer",type:"danger",loading:M}),e.jsx(se,{open:v.open,imageUrl:v.url,title:v.title,onClose:()=>T({open:!1,url:"",title:""})})]})};le.layout=u=>e.jsx(G,{children:u});export{le as default};
