import{u as W,r as a,j as e,H as $,L as z}from"./app-utgbfNX0.js";import{l as d,a as B,L as G}from"./listing-BgDoC534.js";import{L as J}from"./ListingToolbar-D_oC9UU_.js";import{A as Q}from"./app-layout-CFfPYMJg.js";import{R as Y}from"./RichTextEditor-Du5b9XL7.js";import{u as Z}from"./use-listing-search-CM3TCGL3.js";import{u as ee,X as te}from"./NotificationContainer-CfokcVx5.js";import{T as se,C as re}from"./ConfirmDialog-CAlrluB8.js";import{I as ae}from"./ImagePreviewModal-esPlhkOU.js";import{P as ne}from"./plus-LDc-pGbY.js";import{I as oe}from"./image-DzZex1AT.js";import{E as ie}from"./eye-BpnAgMTf.js";import{S as le}from"./square-pen-B0q-z-OZ.js";/* empty css            */import"./utils-LNTPob9H.js";import"./button-Diin00ly.js";import"./index-TFK0zwhy.js";import"./index-x6Y8e2MX.js";import"./proxy-C2tPMP2D.js";import"./index-w_94M6Cx.js";import"./index-CMWG4mbA.js";import"./book-open-C0we6ypj.js";import"./megaphone-CmI5EizT.js";import"./landmark-ikN-vJEZ.js";import"./tag-C7YTYvmc.js";import"./users-DSNz5R3n.js";import"./chevron-right-CcxNG9WG.js";import"./download-DrFBU2mR.js";const ce=({evenements:u=[],categories:R=[],listing:p})=>{const{addNotification:x}=ee(),{url:q}=W(),o=q.split("?")[0],[f,F]=a.useState(p?.filters.search??""),h=p?.filters.sort??"date_debut",j=p?.filters.direction??"desc",l=p?.pagination??{page:1,per_page:15,total:u.length,last_page:1},i=a.useMemo(()=>({search:f,sort:h,direction:j,per_page:l.per_page}),[l.per_page,f,j,h]);Z(o,i);const[A,m]=a.useState(!1),[C,_]=a.useState(!1),[g,S]=a.useState(null),[b,y]=a.useState({open:!1,id:null}),[M,E]=a.useState(!1),[v,k]=a.useState({open:!1,url:"",title:""}),[s,n]=a.useState({titre:"",categorie:"",category_id:"",status:"published",date_debut:"",lieu:"",description:"",contenu:"",is_flash_info:!1}),[L,P]=a.useState(null),[D,N]=a.useState(""),T=()=>{n({titre:"",categorie:"",category_id:"",status:"published",date_debut:"",lieu:"",description:"",contenu:"",is_flash_info:!1}),P(null),N(""),S(null)},O=t=>{n({titre:t.titre||"",categorie:t.categorie||"",category_id:t.category_id?String(t.category_id):"",status:t.status||"published",date_debut:t.date_debut?t.date_debut.slice(0,16):"",lieu:t.lieu||"",description:t.description||"",contenu:t.contenu||"",is_flash_info:t.is_flash_info||!1}),N(t.image_url||""),S(t.id),m(!0)},U=async t=>{t.preventDefault(),_(!0);try{const r=document.querySelector('meta[name="csrf-token"]')?.content??"",c=new FormData;Object.entries(s).forEach(([K,V])=>c.append(K,V??"")),L&&c.append("image",L);const w=g?`/admin/api/evenements/${g}`:"/admin/api/evenements";g&&c.append("_method","PUT");const I=await fetch(w,{method:"POST",headers:{"X-CSRF-TOKEN":r,"X-Requested-With":"XMLHttpRequest"},body:c});if(!I.ok)throw new Error("Erreur de création");const H=await I.json();m(!1),T(),x("success",H.message||(g?"Événement modifié":"Événement créé")),d(o,{...i,page:1})}catch(r){console.error(r),x("error",r instanceof Error?r.message:"Impossible de sauvegarder l'événement.")}finally{_(!1)}},X=async()=>{if(b.id){E(!0);try{const t=document.querySelector('meta[name="csrf-token"]')?.content??"",r=await fetch(`/admin/api/evenements/${b.id}`,{method:"DELETE",headers:{"X-CSRF-TOKEN":t,"X-Requested-With":"XMLHttpRequest"}});if(!r.ok){const w=await r.json();throw new Error(w.message||"Erreur de suppression")}const c=await r.json();x("success",c.message||"Événement supprimé"),y({open:!1,id:null}),d(o,i)}catch(t){console.error(t),x("error",t instanceof Error?t.message:"Impossible de supprimer l'événement.")}finally{E(!1)}}};return e.jsxs("div",{className:"flex flex-col gap-6 p-4",children:[e.jsx($,{title:"Événements"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm uppercase tracking-wide text-gray-500",children:"Contenu"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Événements"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Liste des événements à jour. Ajouter/éditer à connecter ensuite."})]}),e.jsxs("button",{onClick:()=>{T(),m(!0)},className:"inline-flex items-center gap-2 rounded-lg bg-[#f8812f] px-4 py-2 text-sm font-semibold text-white shadow-sm hover:bg-orange-600",children:[e.jsx(ne,{className:"h-4 w-4"}),"Nouvel événement"]})]}),e.jsx(J,{search:f,perPage:l.per_page,sort:{value:h,direction:j},sortOptions:[{value:"date_debut",label:"Date debut"},{value:"created_at",label:"Date creation"},{value:"titre",label:"Titre"},{value:"status",label:"Statut"},{value:"lieu",label:"Lieu"}],onSearchChange:F,onSearchSubmit:()=>d(o,{...i,page:1}),onPerPageChange:t=>d(o,{...i,per_page:t,page:1}),onExport:t=>B(o,i,t),onSortChange:(t,r)=>d(o,{...i,sort:t,direction:r})}),e.jsx("div",{className:"rounded-xl border border-gray-200 bg-white p-0 shadow-sm",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-50 text-left text-xs uppercase text-gray-500",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3",children:"Image"}),e.jsx("th",{className:"px-4 py-3",children:"Titre"}),e.jsx("th",{className:"px-4 py-3",children:"Catégorie"}),e.jsx("th",{className:"px-4 py-3",children:"Lieu"}),e.jsx("th",{className:"px-4 py-3",children:"Date"}),e.jsx("th",{className:"px-4 py-3",children:"Statut"}),e.jsx("th",{className:"px-4 py-3",children:"Actions"})]})}),e.jsx("tbody",{children:u.length?u.map(t=>e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"px-4 py-3",children:t.image_url?e.jsxs("button",{onClick:()=>k({open:!0,url:t.image_url,title:t.titre}),className:"relative group cursor-pointer",title:"Cliquer pour agrandir",children:[e.jsx("img",{src:t.image_url,alt:t.titre,className:"h-12 w-20 rounded object-cover bg-gray-100 transition-all group-hover:ring-2 group-hover:ring-blue-500 group-hover:ring-offset-2"}),e.jsx("div",{className:"absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 transition-opacity rounded flex items-center justify-center",children:e.jsx("svg",{className:"h-5 w-5 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0zM10 7v3m0 0v3m0-3h3m-3 0H7"})})})]}):e.jsx("div",{className:"flex h-12 w-20 items-center justify-center rounded bg-gray-100",children:e.jsx(oe,{className:"h-6 w-6 text-gray-400"})})}),e.jsx("td",{className:"px-4 py-3 font-medium text-gray-900",children:t.titre}),e.jsx("td",{className:"px-4 py-3 text-gray-700",children:t.category?.name||t.categorie||"—"}),e.jsx("td",{className:"px-4 py-3 text-gray-700",children:t.lieu||"—"}),e.jsx("td",{className:"px-4 py-3 text-gray-700",children:t.date_debut?new Date(t.date_debut).toLocaleDateString():"—"}),e.jsx("td",{className:"px-4 py-3 text-gray-700",children:t.status||"draft"}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(z,{href:`/admin/evenements/${t.id}`,className:"rounded p-1.5 text-gray-600 hover:bg-gray-100 transition-colors",title:"Voir le détail",children:e.jsx(ie,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>O(t),className:"rounded p-1.5 text-blue-600 hover:bg-blue-50 transition-colors",title:"Éditer",children:e.jsx(le,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>y({open:!0,id:t.id}),className:"rounded p-1.5 text-red-600 hover:bg-red-50 transition-colors",title:"Supprimer",children:e.jsx(se,{className:"h-4 w-4"})})]})})]},t.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"px-4 py-6 text-center text-gray-500",children:"Aucun événement pour le moment."})})})]})})}),e.jsx(G,{page:l.page,lastPage:l.last_page,total:l.total,onPageChange:t=>d(o,{...i,page:t})}),A&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40 px-4 py-6 overflow-y-auto",children:e.jsxs("div",{className:"w-full max-w-2xl rounded-2xl bg-white shadow-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between border-b px-6 py-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-wide text-gray-500",children:"Nouvel événement"}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Créer un événement"})]}),e.jsx("button",{className:"rounded-full p-2 text-gray-500 hover:bg-gray-100",onClick:()=>m(!1),children:e.jsx(te,{className:"h-5 w-5"})})]}),e.jsxs("form",{className:"space-y-4 px-6 py-5",onSubmit:U,children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Titre *"}),e.jsx("input",{required:!0,value:s.titre,onChange:t=>n({...s,titre:t.target.value}),className:"mt-1 w-full rounded-lg border border-gray-200 px-3 py-2 focus:border-[#f8812f] focus:outline-none focus:ring-2 focus:ring-[#f8812f]/20",placeholder:"Titre de l’événement"})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Catégorie"}),e.jsxs("select",{value:s.category_id,onChange:t=>n({...s,category_id:t.target.value,categorie:""}),className:"mt-1 w-full rounded-lg border border-gray-200 px-3 py-2 focus:border-[#f8812f] focus:outline-none focus:ring-2 focus:ring-[#f8812f]/20",children:[e.jsx("option",{value:"",children:"Sélectionner"}),R.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Catégories limitées au type Événement."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Date de début"}),e.jsx("input",{type:"datetime-local",value:s.date_debut,onChange:t=>n({...s,date_debut:t.target.value}),className:"mt-1 w-full rounded-lg border border-gray-200 px-3 py-2 focus:border-[#f8812f] focus:outline-none focus:ring-2 focus:ring-[#f8812f]/20"})]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Lieu"}),e.jsx("input",{value:s.lieu,onChange:t=>n({...s,lieu:t.target.value}),className:"mt-1 w-full rounded-lg border border-gray-200 px-3 py-2 focus:border-[#f8812f] focus:outline-none focus:ring-2 focus:ring-[#f8812f]/20",placeholder:"Ex: Esplanade de la mairie"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Statut"}),e.jsxs("select",{value:s.status,onChange:t=>n({...s,status:t.target.value}),className:"mt-1 w-full rounded-lg border border-gray-200 px-3 py-2 focus:border-[#f8812f] focus:outline-none focus:ring-2 focus:ring-[#f8812f]/20",children:[e.jsx("option",{value:"published",children:"Publié"}),e.jsx("option",{value:"draft",children:"Brouillon"})]})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-gray-700 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:s.is_flash_info,onChange:t=>n({...s,is_flash_info:t.target.checked}),className:"h-4 w-4 rounded border-gray-300 text-[#f8812f] focus:ring-2 focus:ring-[#f8812f]/20"}),e.jsx("span",{children:"Afficher en flash info"})]}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Afficher cet événement dans le bandeau flash info de la page d'accueil"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Description courte"}),e.jsx("textarea",{value:s.description,onChange:t=>n({...s,description:t.target.value}),rows:3,className:"mt-1 w-full rounded-lg border border-gray-200 px-3 py-2 focus:border-[#f8812f] focus:outline-none focus:ring-2 focus:ring-[#f8812f]/20",placeholder:"Résumé affiché sur la carte"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Contenu détaillé (CKEditor)"}),e.jsx(Y,{value:s.contenu,onChange:t=>n({...s,contenu:t}),placeholder:"Programme, intervenants, détails pratiques..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Image principale"}),e.jsx("input",{type:"file",accept:"image/*",onChange:t=>{const r=t.target.files?.[0]??null;P(r),N(r?URL.createObjectURL(r):"")},className:"mt-1 w-full rounded-lg border border-gray-200 px-3 py-2 focus:border-[#f8812f] focus:outline-none focus:ring-2 focus:ring-[#f8812f]/20"}),D&&e.jsx("div",{className:"mt-3 overflow-hidden rounded-xl border border-gray-200 bg-gray-50",children:e.jsx("img",{src:D,alt:"Prévisualisation",className:"h-40 w-full object-cover"})}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Formats image, max 4 Mo."})]}),e.jsxs("div",{className:"flex items-center justify-end gap-3 border-t pt-4",children:[e.jsx("button",{type:"button",className:"rounded-lg px-4 py-2 text-sm font-semibold text-gray-600 hover:bg-gray-100",onClick:()=>m(!1),children:"Annuler"}),e.jsx("button",{type:"submit",disabled:C,className:"rounded-lg bg-[#f8812f] px-5 py-2 text-sm font-semibold text-white shadow-sm hover:bg-orange-600 disabled:opacity-60",children:C?"Enregistrement...":"Enregistrer"})]})]})]})}),e.jsx(re,{open:b.open,onClose:()=>y({open:!1,id:null}),onConfirm:X,title:"Supprimer cet événement ?",message:"Cette action est irréversible. L'événement sera définitivement supprimé.",confirmText:"Supprimer",type:"danger",loading:M}),e.jsx(ae,{open:v.open,onClose:()=>k({open:!1,url:"",title:""}),imageUrl:v.url,title:v.title})]})};ce.layout=u=>e.jsx(Q,{children:u});export{ce as default};
