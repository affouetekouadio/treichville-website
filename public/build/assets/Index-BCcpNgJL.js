import{u as me,r as o,j as e,H as ue}from"./app-D6kKXF99.js";import{A as pe}from"./app-layout-C2jjdTT_.js";import{u as xe,b as w,X as J}from"./NotificationContainer-BT-c5sXX.js";import{T as fe,C as ge}from"./ConfirmDialog-aofYRKw4.js";import{I as he}from"./ImagePreviewModal-C2aUk5hk.js";import{L as be}from"./ListingToolbar-DdN-fM3Z.js";import{l as u,a as ye,L as je}from"./listing-DkE4S9r-.js";import{u as ve}from"./use-listing-search-Cfe9cgMd.js";import{P as Ne}from"./plus-UnDe78EH.js";import{G as we}from"./grip-vertical-BPvx5Z6_.js";import{E as Ce}from"./eye-DopyIDTZ.js";import{L as Se}from"./landmark-Cm81SObB.js";import{c as W}from"./proxy-hi-s8ZU_.js";import{T as z}from"./trees-DcSJ-FwN.js";import{W as qe}from"./waves-CHs3TzQu.js";import{S as ke}from"./square-pen-CKOLoaH4.js";import{U as Ee}from"./upload-C1VjokKW.js";/* empty css            */import"./utils-ALYWs1Gd.js";import"./index-DCUGYyOh.js";import"./button-B5k_BnNa.js";import"./index-BpwMDNmh.js";import"./index-VjNSY46-.js";import"./index-CjaKH9ar.js";import"./index-Fv__CLny.js";import"./index-w_94M6Cx.js";import"./index-CMWG4mbA.js";import"./book-open-DKjhm4ZH.js";import"./megaphone-Cbc3w7gv.js";import"./tag-2FDY3cPo.js";import"./users-DcN1oeZo.js";import"./chevron-right-DvLDHTaz.js";import"./download-DUxR2ONm.js";const Pe=[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}],["path",{d:"M3.22 12H9.5l.5-1 2 4.5 2-7 1.5 3.5h5.27",key:"1uw2ng"}]],_e=W("HeartPulse",Pe);const Le=[["circle",{cx:"13.5",cy:"6.5",r:".5",fill:"currentColor",key:"1okk4w"}],["circle",{cx:"17.5",cy:"10.5",r:".5",fill:"currentColor",key:"f64h9f"}],["circle",{cx:"8.5",cy:"7.5",r:".5",fill:"currentColor",key:"fotxhn"}],["circle",{cx:"6.5",cy:"12.5",r:".5",fill:"currentColor",key:"qy21gx"}],["path",{d:"M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10c.926 0 1.648-.746 1.648-1.688 0-.437-.18-.835-.437-1.125-.29-.289-.438-.652-.438-1.125a1.64 1.64 0 0 1 1.668-1.668h1.996c3.051 0 5.555-2.503 5.555-5.554C21.965 6.012 17.461 2 12 2z",key:"12rzf8"}]],De=W("Palette",Le),Ie=({lieux:p=[],listing:j})=>{const{addNotification:x}=xe(),{url:K}=me(),l=K.split("?")[0],[C,F]=o.useState(p),[V,h]=o.useState(!1),[A,O]=o.useState(!1),[f,R]=o.useState(null),[S,q]=o.useState({open:!1,id:null}),[Z,X]=o.useState(!1),[k,H]=o.useState({open:!1,url:"",title:""}),[G,E]=o.useState(null),[r,i]=o.useState({type:"Parc",nom:"",description:"",horaires:"",acces:"Gratuit",equipements:[""],actif:!0,is_flash_info:!1}),[$,P]=o.useState(null),[v,_]=o.useState(null),B=[{value:"Parc",label:"Parc"},{value:"Piscine",label:"Piscine"},{value:"Jardin",label:"Jardin"},{value:"Culture",label:"Lieu culturel"},{value:"Sante",label:"Santé"},{value:"Monument",label:"Monument"}],Q={Parc:{label:"Parc",icon:z,className:"bg-green-100 text-green-700"},Piscine:{label:"Piscine",icon:qe,className:"bg-blue-100 text-blue-700"},Jardin:{label:"Jardin",icon:z,className:"bg-emerald-100 text-emerald-700"},Culture:{label:"Culture",icon:De,className:"bg-purple-100 text-purple-700"},Sante:{label:"Santé",icon:_e,className:"bg-rose-100 text-rose-700"},Monument:{label:"Monument",icon:Se,className:"bg-amber-100 text-amber-700"}},[L,Y]=o.useState(j?.filters.search??""),D=j?.filters.sort??"ordre",I=j?.filters.direction??"asc",g=j?.pagination??{page:1,per_page:15,total:p.length,last_page:1},c=o.useMemo(()=>({search:L,sort:D,direction:I,per_page:g.per_page}),[g.per_page,L,I,D]);ve(l,c),o.useEffect(()=>{F(p)},[p]);const N=()=>{i({type:"Parc",nom:"",description:"",horaires:"",acces:"Gratuit",equipements:[""],actif:!0,is_flash_info:!1}),P(null),E(null),R(null)},ee=t=>{i({type:t.type,nom:t.nom,description:t.description,horaires:t.horaires||"",acces:t.acces,equipements:t.equipements&&t.equipements.length>0?t.equipements:[""],actif:t.actif,is_flash_info:t.is_flash_info||!1}),P(null),E(t.image_url),R(t.id),h(!0)},te=async t=>{t.preventDefault(),O(!0);try{const s=new FormData;s.append("type",r.type),s.append("nom",r.nom),s.append("description",r.description),s.append("horaires",r.horaires||""),s.append("acces",r.acces),s.append("actif",r.actif?"1":"0"),s.append("is_flash_info",r.is_flash_info?"1":"0"),r.equipements.filter(d=>d.trim()!=="").forEach((d,n)=>{s.append(`equipements[${n}]`,d)}),$&&s.append("image",$),f&&s.append("_method","PUT");const m=document.querySelector('meta[name="csrf-token"]')?.content??"",T=f?`/admin/api/lieux/${f}`:"/admin/api/lieux",b=await fetch(T,{method:"POST",headers:{"X-CSRF-TOKEN":m,"X-Requested-With":"XMLHttpRequest"},body:s});if(!b.ok){const d=await b.json();throw new Error(d.message||"Erreur de sauvegarde")}const M=await b.json();x("success",M.message||(f?"Lieu modifié":"Lieu créé")),h(!1),N(),u(l,{...c,page:1})}catch(s){console.error(s),x("error",s instanceof Error?s.message:"Impossible de sauvegarder le lieu")}finally{O(!1)}},se=t=>{q({open:!0,id:t})},re=async()=>{if(S.id){X(!0);try{const t=document.querySelector('meta[name="csrf-token"]')?.content??"",s=await fetch(`/admin/api/lieux/${S.id}`,{method:"DELETE",headers:{"X-CSRF-TOKEN":t,"X-Requested-With":"XMLHttpRequest"}});if(!s.ok){const m=await s.json();throw new Error(m.message||"Erreur de suppression")}const a=await s.json();x("success",a.message||"Lieu supprimé"),q({open:!1,id:null}),u(l,c)}catch(t){console.error(t),x("error",t instanceof Error?t.message:"Impossible de supprimer le lieu")}finally{X(!1)}}},ae=t=>{const s=t.target.files?.[0];s&&(P(s),E(URL.createObjectURL(s)))},ne=()=>{i({...r,equipements:[...r.equipements,""]})},oe=t=>{const s=r.equipements.filter((a,m)=>m!==t);i({...r,equipements:s.length>0?s:[""]})},ie=(t,s)=>{const a=[...r.equipements];a[t]=s,i({...r,equipements:a})},le=(t,s)=>{_(s),t.dataTransfer.effectAllowed="move"},ce=t=>{t.preventDefault(),t.dataTransfer.dropEffect="move"},de=async(t,s)=>{if(t.preventDefault(),!v||v===s){_(null);return}const a=[...C],m=a.findIndex(n=>n.id===v),T=a.findIndex(n=>n.id===s),[b]=a.splice(m,1);a.splice(T,0,b);const M=a.map(n=>n.ordre).sort((n,y)=>n-y),d=a.map((n,y)=>({...n,ordre:M[y]??n.ordre}));F(d),_(null);try{const n=document.querySelector('meta[name="csrf-token"]')?.content??"",y=d.map(U=>({id:U.id,ordre:U.ordre}));if(!(await fetch("/admin/api/lieux/update-order",{method:"POST",headers:{"X-CSRF-TOKEN":n,"X-Requested-With":"XMLHttpRequest","Content-Type":"application/json"},body:JSON.stringify({orders:y})})).ok)throw new Error("Erreur lors de la mise à jour de l'ordre");x("success","Ordre mis à jour")}catch(n){console.error(n),x("error","Erreur lors de la mise à jour de l'ordre"),u(l,c)}};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-col gap-6 p-4",children:[e.jsx(ue,{title:"Endroit à découvrir"}),e.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex h-10 w-10 items-center justify-center rounded-lg bg-blue-100",children:e.jsx(w,{className:"h-5 w-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Endroit à découvrir"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Gestion des parcs et piscines (ordre modifiable par glisser-déposer)"})]})]}),e.jsxs("button",{onClick:()=>{N(),h(!0)},className:"inline-flex items-center gap-2 rounded-lg bg-[#f8812f] px-4 py-2 text-sm font-semibold text-white shadow-sm hover:bg-orange-600 transition-colors",children:[e.jsx(Ne,{className:"h-4 w-4"}),"Nouveau lieu"]})]}),e.jsx(be,{search:L,perPage:g.per_page,sort:{value:D,direction:I},sortOptions:[{value:"ordre",label:"Ordre"},{value:"nom",label:"Nom"},{value:"type",label:"Type"},{value:"created_at",label:"Créé le"}],onSearchChange:Y,onSearchSubmit:()=>u(l,{...c,page:1}),onPerPageChange:t=>u(l,{...c,per_page:t,page:1}),onExport:t=>ye(l,c,t),onSortChange:(t,s)=>u(l,{...c,sort:t,direction:s})}),e.jsx("div",{className:"rounded-xl border border-gray-200 bg-white shadow-sm",children:C.length===0?e.jsxs("div",{className:"p-12 text-center",children:[e.jsx(w,{className:"mx-auto h-12 w-12 text-[#03800a]"}),e.jsx("h3",{className:"mt-4 text-lg font-semibold text-gray-900",children:"Aucun lieu"}),e.jsx("p",{className:"mt-2 text-sm text-gray-500",children:"Commencez par ajouter un parc ou une piscine"})]}):e.jsx("div",{className:"divide-y divide-gray-200",children:C.map(t=>e.jsxs("div",{draggable:!0,onDragStart:s=>le(s,t.id),onDragOver:ce,onDrop:s=>de(s,t.id),className:`flex items-center gap-4 p-4 transition-colors ${v===t.id?"opacity-50":"hover:bg-gray-50"} ${t.actif?"":"bg-gray-50"}`,children:[e.jsx("div",{className:"cursor-move text-gray-400 hover:text-[#03800a]",children:e.jsx(we,{className:"h-5 w-5"})}),e.jsx("div",{className:"flex-shrink-0",children:t.image_url?e.jsxs("button",{onClick:()=>H({open:!0,url:t.image_url,title:t.nom}),className:"relative group",children:[e.jsx("img",{src:t.image_url,alt:t.nom,className:"h-16 w-16 rounded-lg object-cover ring-2 ring-gray-200 group-hover:ring-[#f8812f] transition-all"}),e.jsx("div",{className:"absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 transition-opacity rounded-lg flex items-center justify-center",children:e.jsx(Ce,{className:"h-5 w-5 text-white"})})]}):e.jsx("div",{className:"h-16 w-16 rounded-lg bg-gray-100 flex items-center justify-center",children:e.jsx(w,{className:"h-8 w-8 text-gray-400"})})}),e.jsx("div",{className:"flex-shrink-0",children:(()=>{const s=Q[t.type]||{label:t.type,icon:w,className:"bg-gray-100 text-gray-700"},a=s.icon;return e.jsxs("span",{className:`inline-flex items-center gap-1 rounded-full px-3 py-1 text-xs font-medium ${s.className}`,children:[e.jsx(a,{className:"h-3 w-3"}),s.label]})})()}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"text-base font-semibold text-gray-900",children:t.nom}),!t.actif&&e.jsx("span",{className:"inline-flex items-center rounded-full bg-gray-100 px-2 py-0.5 text-xs font-medium text-gray-600",children:"Inactif"}),e.jsx("span",{className:`inline-flex items-center rounded-full px-2 py-0.5 text-xs font-medium ${t.acces==="Gratuit"?"bg-green-100 text-green-700":"bg-orange-100 text-orange-700"}`,children:t.acces})]}),e.jsx("p",{className:"text-sm text-gray-600 line-clamp-1",children:t.description})]}),e.jsx("div",{className:"text-center",children:e.jsx("span",{className:"inline-flex h-8 w-8 items-center justify-center rounded-full bg-blue-100 text-sm font-semibold text-blue-600",children:t.ordre})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>ee(t),className:"rounded p-2 text-blue-600 hover:bg-blue-50 transition-colors",title:"Éditer",children:e.jsx(ke,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>se(t.id),className:"rounded p-2 text-red-600 hover:bg-red-50 transition-colors",title:"Supprimer",children:e.jsx(fe,{className:"h-4 w-4"})})]})]},t.id))})}),e.jsx(je,{page:g.page,lastPage:g.last_page,total:g.total,onPageChange:t=>u(l,{...c,page:t})})]}),V&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-start justify-center bg-black/40 px-4 overflow-y-auto py-6",children:e.jsxs("div",{className:"w-full max-w-2xl rounded-2xl bg-white shadow-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between border-b px-6 py-4",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-xs uppercase tracking-wide text-gray-500",children:[f?"Modifier":"Nouveau"," lieu"]}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:f?"Modifier le lieu":"Ajouter un lieu"})]}),e.jsx("button",{onClick:()=>{h(!1),N()},className:"rounded-full p-2 text-gray-500 hover:bg-gray-100",children:e.jsx(J,{className:"h-5 w-5"})})]}),e.jsxs("form",{className:"space-y-4 px-6 py-5",onSubmit:te,children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Type *"}),e.jsx("select",{required:!0,value:r.type,onChange:t=>i({...r,type:t.target.value}),className:"mt-1 w-full rounded-lg border border-gray-200 px-3 py-2 focus:border-[#f8812f] focus:outline-none focus:ring-2 focus:ring-orange-200",children:B.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Accès *"}),e.jsxs("select",{required:!0,value:r.acces,onChange:t=>i({...r,acces:t.target.value}),className:"mt-1 w-full rounded-lg border border-gray-200 px-3 py-2 focus:border-[#f8812f] focus:outline-none focus:ring-2 focus:ring-orange-200",children:[e.jsx("option",{value:"Gratuit",children:"Gratuit"}),e.jsx("option",{value:"Payant",children:"Payant"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Nom *"}),e.jsx("input",{required:!0,value:r.nom,onChange:t=>i({...r,nom:t.target.value}),className:"mt-1 w-full rounded-lg border border-gray-200 px-3 py-2 focus:border-[#f8812f] focus:outline-none focus:ring-2 focus:ring-orange-200",placeholder:"Ex: Jardin Public de Treichville"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Description *"}),e.jsx("textarea",{required:!0,rows:3,value:r.description,onChange:t=>i({...r,description:t.target.value}),className:"mt-1 w-full rounded-lg border border-gray-200 px-3 py-2 focus:border-[#f8812f] focus:outline-none focus:ring-2 focus:ring-orange-200",placeholder:"Décrivez le lieu..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Horaires (optionnel)"}),e.jsx("input",{value:r.horaires,onChange:t=>i({...r,horaires:t.target.value}),className:"mt-1 w-full rounded-lg border border-gray-200 px-3 py-2 focus:border-[#f8812f] focus:outline-none focus:ring-2 focus:ring-orange-200",placeholder:"Ex: 6h00 - 18h00"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 mb-2 block",children:"Équipements (optionnel)"}),r.equipements.map((t,s)=>e.jsxs("div",{className:"flex gap-2 mb-2",children:[e.jsx("input",{value:t,onChange:a=>ie(s,a.target.value),className:"flex-1 rounded-lg border border-gray-200 px-3 py-2 focus:border-[#f8812f] focus:outline-none focus:ring-2 focus:ring-orange-200",placeholder:"Ex: Aires de jeux"}),r.equipements.length>1&&e.jsx("button",{type:"button",onClick:()=>oe(s),className:"px-3 py-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors",children:e.jsx(J,{className:"h-4 w-4"})})]},s)),e.jsx("button",{type:"button",onClick:ne,className:"mt-1 text-sm text-[#03800a] hover:text-green-700 font-medium",children:"+ Ajouter un équipement"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Photo"}),G&&e.jsx("div",{className:"mt-2 mb-3",children:e.jsx("img",{src:G,alt:"Aperçu",className:"h-32 w-full rounded-lg object-cover border-2 border-orange-200"})}),e.jsxs("label",{className:"mt-2 flex cursor-pointer items-center gap-2 rounded-lg border-2 border-dashed border-gray-300 px-4 py-3 hover:border-[#f8812f] hover:bg-orange-50 transition-colors",children:[e.jsx(Ee,{className:"h-5 w-5 text-gray-500"}),e.jsx("span",{className:"text-sm text-gray-600",children:"Choisir une photo"}),e.jsx("input",{type:"file",accept:"image/*",onChange:ae,className:"hidden"})]}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Format image, max 10 Mo"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",id:"actif",checked:r.actif,onChange:t=>i({...r,actif:t.target.checked}),className:"h-4 w-4 rounded border-gray-300 text-[#03800a] focus:ring-[#03800a]"}),e.jsx("label",{htmlFor:"actif",className:"text-sm font-medium text-gray-700",children:"Actif (visible sur le site)"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",id:"is_flash_info",checked:r.is_flash_info,onChange:t=>i({...r,is_flash_info:t.target.checked}),className:"h-4 w-4 rounded border-gray-300 text-[#f8812f] focus:ring-[#f8812f]"}),e.jsx("label",{htmlFor:"is_flash_info",className:"text-sm font-medium text-gray-700",children:"Afficher en flash info"})]}),e.jsx("p",{className:"text-xs text-gray-500 -mt-2 ml-7",children:"Afficher ce lieu dans le bandeau flash info de la page d'accueil"}),e.jsxs("div",{className:"flex items-center justify-end gap-3 border-t pt-4",children:[e.jsx("button",{type:"button",onClick:()=>{h(!1),N()},className:"rounded-lg px-4 py-2 text-sm font-semibold text-gray-600 hover:bg-gray-100",children:"Annuler"}),e.jsx("button",{type:"submit",disabled:A,className:"rounded-lg bg-[#03800a] px-5 py-2 text-sm font-semibold text-white shadow-sm hover:bg-green-700 disabled:opacity-60",children:A?"Enregistrement...":"Enregistrer"})]})]})]})}),e.jsx(ge,{open:S.open,onClose:()=>q({open:!1,id:null}),onConfirm:re,title:"Supprimer ce lieu ?",message:"Cette action est irréversible. Le lieu sera définitivement supprimé.",confirmText:"Supprimer",type:"danger",loading:Z}),e.jsx(he,{open:k.open,onClose:()=>H({open:!1,url:"",title:""}),imageUrl:k.url,title:k.title})]})};Ie.layout=p=>e.jsx(pe,{children:p});export{Ie as default};
