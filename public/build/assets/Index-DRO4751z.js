import{u as K,r,j as e,H as U,L as V}from"./app-zp8a_1Kz.js";import{l as d,a as W,L as z}from"./listing-CyK14IAB.js";import{L as G}from"./ListingToolbar-BSqKS32_.js";import{A as J}from"./app-layout-CePoWWuH.js";import{R as Q}from"./RichTextEditor-Dl7IrOZS.js";import{u as Y}from"./use-listing-search-E-iLxo6C.js";import{u as Z,X as ee}from"./NotificationContainer-gxxL-dmH.js";import{T as te,C as se}from"./ConfirmDialog-Br3_tiJq.js";import{I as ae}from"./ImagePreviewModal-b_Jp4KPZ.js";import{P as re}from"./plus-CUhRo2XF.js";import{I as le}from"./image-BxdpKVyZ.js";import{E as ie}from"./eye-BVJGR6gk.js";import{S as oe}from"./square-pen-CR4kVuYF.js";/* empty css            */import"./utils-BXHwvztH.js";import"./button-CiEhR-Zp.js";import"./index-BJyFvceU.js";import"./index-Cn9ca9qa.js";import"./proxy-CiNOm1L4.js";import"./index-w_94M6Cx.js";import"./index-CMWG4mbA.js";import"./book-open-BMmTLku0.js";import"./megaphone-9k5Y78Jh.js";import"./landmark-CZwsELM-.js";import"./tag-CRsMMEZF.js";import"./users-CfERKPYF.js";import"./chevron-right-D4ZEOqXu.js";import"./download-BEF9xMVZ.js";const ne=({actualites:u=[],categories:T=[],listing:m})=>{const{addNotification:x}=Z(),{url:I}=K(),i=I.split("?")[0],[h,F]=r.useState(m?.filters.search??""),f=m?.filters.sort??"created_at",b=m?.filters.direction??"desc",n=m?.pagination??{page:1,per_page:15,total:u.length,last_page:1},o=r.useMemo(()=>({search:h,sort:f,direction:b,per_page:n.per_page}),[n.per_page,h,b,f]);Y(i,o);const[R,p]=r.useState(!1),[S,_]=r.useState(!1),[g,E]=r.useState(null),[j,y]=r.useState({open:!1,id:null}),[q,k]=r.useState(!1),[N,P]=r.useState({open:!1,url:"",title:""}),[s,l]=r.useState({titre:"",categorie:"",category_id:"",status:"published",published_at:"",description:"",contenu:"",est_flash_info:!1}),[A,D]=r.useState(null),L=()=>{l({titre:"",categorie:"",category_id:"",status:"published",published_at:"",description:"",contenu:"",est_flash_info:!1}),D(null),E(null)},M=async t=>{t.preventDefault(),_(!0);try{const a=document.querySelector('meta[name="csrf-token"]')?.content??"",c=new FormData;Object.entries(s).forEach(([C,B])=>c.append(C,B??"")),A&&c.append("image",A),g&&c.append("_method","PUT");const v=g?`/admin/api/actualites/${g}`:"/admin/api/actualites",w=await fetch(v,{method:"POST",headers:{"X-CSRF-TOKEN":a,"X-Requested-With":"XMLHttpRequest"},body:c});if(!w.ok){const C=await w.json();throw new Error(C.message||"Erreur de sauvegarde")}const $=await w.json();x("success",$.message||(g?"Actualité modifiée":"Actualité créée")),p(!1),L(),d(i,{...o,page:1})}catch(a){console.error(a),x("error",a instanceof Error?a.message:"Impossible de sauvegarder l'actualité")}finally{_(!1)}},X=t=>{l({titre:t.titre,categorie:t.categorie||"",category_id:String(t.category_id||""),status:t.status||"draft",published_at:t.published_at?t.published_at.split("T")[0]:"",description:t.description||"",contenu:t.contenu||"",est_flash_info:t.est_flash_info||!1}),E(t.id),p(!0)},O=t=>{y({open:!0,id:t})},H=async()=>{if(j.id){k(!0);try{const t=document.querySelector('meta[name="csrf-token"]')?.content??"",a=await fetch(`/admin/api/actualites/${j.id}`,{method:"DELETE",headers:{"X-CSRF-TOKEN":t,"X-Requested-With":"XMLHttpRequest"}});if(!a.ok){const v=await a.json();throw new Error(v.message||"Erreur de suppression")}const c=await a.json();x("success",c.message||"Actualité supprimée"),y({open:!1,id:null}),d(i,o)}catch(t){console.error(t),x("error",t instanceof Error?t.message:"Impossible de supprimer l'actualité")}finally{k(!1)}}};return e.jsxs("div",{className:"flex flex-col gap-6 p-4",children:[e.jsx(U,{title:"Actualités"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm uppercase tracking-wide text-gray-500",children:"Contenu"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Actualités"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Liste des articles déjà saisis. Ajouter/éditer à connecter ensuite."})]}),e.jsxs("button",{onClick:()=>p(!0),className:"inline-flex items-center gap-2 rounded-lg bg-[#03800a] px-4 py-2 text-sm font-semibold text-white shadow-sm hover:bg-[#166e7b]",children:[e.jsx(re,{className:"h-4 w-4"}),"Nouvelle actualité"]})]}),e.jsx(G,{search:h,perPage:n.per_page,sort:{value:f,direction:b},sortOptions:[{value:"created_at",label:"Date creation"},{value:"published_at",label:"Date publication"},{value:"titre",label:"Titre"},{value:"status",label:"Statut"}],onSearchChange:F,onSearchSubmit:()=>d(i,{...o,page:1}),onPerPageChange:t=>d(i,{...o,per_page:t,page:1}),onExport:t=>W(i,o,t),onSortChange:(t,a)=>d(i,{...o,sort:t,direction:a})}),e.jsx("div",{className:"rounded-xl border border-gray-200 bg-white p-0 shadow-sm",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-50 text-left text-xs uppercase text-gray-500",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3",children:"Image"}),e.jsx("th",{className:"px-4 py-3",children:"Titre"}),e.jsx("th",{className:"px-4 py-3",children:"Catégorie"}),e.jsx("th",{className:"px-4 py-3",children:"Statut"}),e.jsx("th",{className:"px-4 py-3",children:"Publié le"}),e.jsx("th",{className:"px-4 py-3",children:"Actions"})]})}),e.jsx("tbody",{children:u.length?u.map(t=>e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"px-4 py-3",children:t.image_url?e.jsxs("button",{onClick:()=>P({open:!0,url:t.image_url,title:t.titre}),className:"relative group cursor-pointer",title:"Cliquer pour agrandir",children:[e.jsx("img",{src:t.image_url,alt:t.titre,className:"h-12 w-20 rounded object-cover bg-gray-100 transition-all group-hover:ring-2 group-hover:ring-blue-500 group-hover:ring-offset-2"}),e.jsx("div",{className:"absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 transition-opacity rounded flex items-center justify-center",children:e.jsx("svg",{className:"h-5 w-5 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0zM10 7v3m0 0v3m0-3h3m-3 0H7"})})})]}):e.jsx("div",{className:"flex h-12 w-20 items-center justify-center rounded bg-gray-100",children:e.jsx(le,{className:"h-6 w-6 text-gray-400"})})}),e.jsx("td",{className:"px-4 py-3 font-medium text-gray-900",children:t.titre}),e.jsx("td",{className:"px-4 py-3 text-gray-700",children:t.category?.name||t.categorie||"—"}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:`inline-flex rounded-full px-2 py-1 text-xs font-semibold ${t.status==="published"?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:t.status==="published"?"Publié":"Brouillon"})}),e.jsx("td",{className:"px-4 py-3 text-gray-700",children:t.published_at?new Date(t.published_at).toLocaleDateString():"—"}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(V,{href:`/admin/actualites/${t.id}`,className:"rounded p-1 text-gray-600 hover:bg-gray-100",title:"Voir le détail",children:e.jsx(ie,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>X(t),className:"rounded p-1 text-blue-600 hover:bg-blue-50",title:"Éditer",children:e.jsx(oe,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>O(t.id),className:"rounded p-1 text-red-600 hover:bg-red-50",title:"Supprimer",children:e.jsx(te,{className:"h-4 w-4"})})]})})]},t.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"px-4 py-6 text-center text-gray-500",children:"Aucune actualité pour le moment."})})})]})})}),e.jsx(z,{page:n.page,lastPage:n.last_page,total:n.total,onPageChange:t=>d(i,{...o,page:t})}),R&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40 px-4 py-6 overflow-y-auto",children:e.jsxs("div",{className:"w-full max-w-2xl rounded-2xl bg-white shadow-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between border-b px-6 py-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-wide text-gray-500",children:"Nouvelle actualité"}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Créer un article"})]}),e.jsx("button",{className:"rounded-full p-2 text-gray-500 hover:bg-gray-100",onClick:()=>{p(!1),L()},children:e.jsx(ee,{className:"h-5 w-5"})})]}),e.jsxs("form",{className:"space-y-4 px-6 py-5",onSubmit:M,children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Titre *"}),e.jsx("input",{required:!0,value:s.titre,onChange:t=>l({...s,titre:t.target.value}),className:"mt-1 w-full rounded-lg border border-gray-200 px-3 py-2 focus:border-[#03800a] focus:outline-none focus:ring-2 focus:ring-[#03800a]/20",placeholder:"Titre de l’article"})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Catégorie"}),e.jsxs("select",{value:s.category_id,onChange:t=>l({...s,category_id:t.target.value,categorie:""}),className:"mt-1 w-full rounded-lg border border-gray-200 px-3 py-2 focus:border-[#03800a] focus:outline-none focus:ring-2 focus:ring-[#03800a]/20",children:[e.jsx("option",{value:"",children:"Sélectionner"}),T.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Catégories limitées au type Actualité."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Publié le"}),e.jsx("input",{type:"date",value:s.published_at,onChange:t=>l({...s,published_at:t.target.value}),className:"mt-1 w-full rounded-lg border border-gray-200 px-3 py-2 focus:border-[#03800a] focus:outline-none focus:ring-2 focus:ring-[#03800a]/20"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Statut"}),e.jsxs("select",{value:s.status,onChange:t=>l({...s,status:t.target.value}),className:"mt-1 w-full rounded-lg border border-gray-200 px-3 py-2 focus:border-[#03800a] focus:outline-none focus:ring-2 focus:ring-[#03800a]/20",children:[e.jsx("option",{value:"published",children:"Publié"}),e.jsx("option",{value:"draft",children:"Brouillon"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-gray-700 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:s.est_flash_info,onChange:t=>l({...s,est_flash_info:t.target.checked}),className:"h-4 w-4 rounded border-gray-300 text-[#03800a] focus:ring-2 focus:ring-[#03800a]/20"}),e.jsx("span",{children:"Afficher en flash info"})]}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Afficher cette actualité dans le bandeau flash info de la page d'accueil"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Description courte"}),e.jsx("textarea",{value:s.description,onChange:t=>l({...s,description:t.target.value}),rows:3,className:"mt-1 w-full rounded-lg border border-gray-200 px-3 py-2 focus:border-[#03800a] focus:outline-none focus:ring-2 focus:ring-[#03800a]/20",placeholder:"Résumé affiché sur la carte"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Contenu (CKEditor)"}),e.jsx(Q,{value:s.contenu,onChange:t=>l({...s,contenu:t}),placeholder:"Saisir l’article complet"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Image principale"}),e.jsx("input",{type:"file",accept:"image/*",onChange:t=>D(t.target.files?.[0]??null),className:"mt-1 w-full rounded-lg border border-gray-200 px-3 py-2 focus:border-[#03800a] focus:outline-none focus:ring-2 focus:ring-[#03800a]/20"}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Formats image, max 4 Mo."})]}),e.jsxs("div",{className:"flex items-center justify-end gap-3 border-t pt-4",children:[e.jsx("button",{type:"button",className:"rounded-lg px-4 py-2 text-sm font-semibold text-gray-600 hover:bg-gray-100",onClick:()=>p(!1),children:"Annuler"}),e.jsx("button",{type:"submit",disabled:S,className:"rounded-lg bg-[#03800a] px-5 py-2 text-sm font-semibold text-white shadow-sm hover:bg-[#166e7b] disabled:opacity-60",children:S?"Enregistrement...":"Enregistrer"})]})]})]})}),e.jsx(se,{open:j.open,onClose:()=>y({open:!1,id:null}),onConfirm:H,title:"Supprimer cette actualité ?",message:"Cette action est irréversible. L'actualité sera définitivement supprimée.",confirmText:"Supprimer",type:"danger",loading:q}),e.jsx(ae,{open:N.open,onClose:()=>P({open:!1,url:"",title:""}),imageUrl:N.url,title:N.title})]})};ne.layout=u=>e.jsx(J,{children:u});export{ne as default};
